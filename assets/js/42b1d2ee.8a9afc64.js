"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[654],{3598:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>r,default:()=>d,frontMatter:()=>s,metadata:()=>l,toc:()=>u});var a=n(7462),i=(n(7294),n(3905)),o=n(2004);const s={},r="Authoring Flows Incrementally",l={unversionedId:"metaflow/authoring-flows/introduction",id:"metaflow/authoring-flows/introduction",title:"Authoring Flows Incrementally",description:"Every non-trivial piece of software is built incrementally, one piece at a time.",source:"@site/docs/metaflow/authoring-flows/introduction.md",sourceDirName:"metaflow/authoring-flows",slug:"/metaflow/authoring-flows/introduction",permalink:"/metaflow/authoring-flows/introduction",draft:!1,editUrl:"https://github.dev/Netflix/metaflow-docs/blob/master/docs/metaflow/authoring-flows/introduction.md",tags:[],version:"current",frontMatter:{},sidebar:"python",previous:{title:"Inspecting Flows and Results",permalink:"/metaflow/client"},next:{title:"Spin Inputs And Outputs",permalink:"/metaflow/authoring-flows/spin-input-output"}},p={},u=[{value:"The <code>spin</code> command",id:"the-spin-command",level:2},{value:"The properties of <code>spin</code>",id:"the-properties-of-spin",level:3},{value:"Testing a step with past results",id:"testing-a-step-with-past-results",level:3}],m={toc:u};function d(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"authoring-flows-incrementally"},"Authoring Flows Incrementally"),(0,i.kt)("p",null,"Every non-trivial piece of software is built incrementally, one piece at a time."),(0,i.kt)("p",null,"With Metaflow, you might start with a simple stub, perhaps just a step to load data,\nand then gradually add more ",(0,i.kt)("inlineCode",{parentName:"p"},"@step"),"s, say, for data transformation, model training,\nand beyond, testing the flow at each iteration. To enable a smooth development\nexperience, these iterations should run quickly, with minimal waiting - much\nlike the familiar workflow in a notebook, where you build results one cell at a time."),(0,i.kt)("h2",{id:"the-spin-command"},"The ",(0,i.kt)("inlineCode",{parentName:"h2"},"spin")," command"),(0,i.kt)("admonition",{title:"New Feature",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"spin")," command was introduced in Metaflow\n2.19. ",(0,i.kt)("a",{parentName:"p",href:"https://netflixtechblog.medium.com/b2d5b95c63eb"},"Read the announcement blog post for motivation"),".")),(0,i.kt)("p",null,"While you can certainly ",(0,i.kt)("inlineCode",{parentName:"p"},"run"),' a flow from start to end at each iteration -\nsimilar to the "Run All" mode in notebooks - this can take a while. You\ncan use ',(0,i.kt)("a",{parentName:"p",href:"/metaflow/debugging#how-to-use-the-resume-command"},(0,i.kt)("inlineCode",{parentName:"a"},"resume"))," to run a part of\na flow, reusing past results, but even this might be\noverkill when you are focused on developing a particular ",(0,i.kt)("inlineCode",{parentName:"p"},"@step")," and you just\nwant to test it with appropriate input data."),(0,i.kt)("p",null,"Metaflow provides a ",(0,i.kt)("inlineCode",{parentName:"p"},"spin")," command to address this use case: rapid, iterative\ndevelopment and testing of a single step. Watch this one minute video\nto see it in action:"),(0,i.kt)(o.Z,{controls:!0,url:"https://youtu.be/3RNMM-lthm0",mdxType:"ReactPlayer"}),(0,i.kt)("br",null),(0,i.kt)("p",null,"As shown in the video, you can use ",(0,i.kt)("inlineCode",{parentName:"p"},"spin")," to author flows incrementally following\nthis pattern:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Develop a stub of a flow - at the minimum, add ",(0,i.kt)("inlineCode",{parentName:"li"},"start")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"end")," steps."),(0,i.kt)("li",{parentName:"ol"},"Use ",(0,i.kt)("inlineCode",{parentName:"li"},"run")," to run the flow to produce an initial set of inputs."),(0,i.kt)("li",{parentName:"ol"},"Edit any step, ",(0,i.kt)("inlineCode",{parentName:"li"},"somestep"),"."),(0,i.kt)("li",{parentName:"ol"},"Use ",(0,i.kt)("inlineCode",{parentName:"li"},"python myflow.py spin somestep")," to test the changes quickly using\nthe input artifacts from the latest run (or any earlier run)."),(0,i.kt)("li",{parentName:"ol"},"Once ",(0,i.kt)("inlineCode",{parentName:"li"},"somestep")," seems to work, add a next step and repeate the process from (2)\nuntil the flow is complete.")),(0,i.kt)("h3",{id:"the-properties-of-spin"},"The properties of ",(0,i.kt)("inlineCode",{parentName:"h3"},"spin")),(0,i.kt)("p",null,"As ",(0,i.kt)("inlineCode",{parentName:"p"},"spin")," is meant for rapid testing of an individual step, it doesn't track\nmetadata or persist artifacts by default. Hence you won't see the ",(0,i.kt)("inlineCode",{parentName:"p"},"spin")," iterations\non the Metaflow UI, and you can't access artifacts globally using\n",(0,i.kt)("a",{parentName:"p",href:"/metaflow/client"},"the Client API"),". Instead, you can eyeball logs on the console and\noptionally ",(0,i.kt)("a",{parentName:"p",href:"/metaflow/authoring-flows/spin-input-output"},"access the output artifacts locally"),".\nOnce the step seems to work, just ",(0,i.kt)("inlineCode",{parentName:"p"},"run")," the flow as usual to take a snapshot of all\nmetadata and artifacts."),(0,i.kt)("p",null,"Currently ",(0,i.kt)("inlineCode",{parentName:"p"},"spin")," doesn't support\n",(0,i.kt)("a",{parentName:"p",href:"/scaling/remote-tasks/requesting-resources"},"executing tasks remotely")," but you can use\n",(0,i.kt)("inlineCode",{parentName:"p"},"@pypi")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"@conda")," for ",(0,i.kt)("a",{parentName:"p",href:"scaling/dependencies"},"dependency management")," as usual. Also,\n",(0,i.kt)("inlineCode",{parentName:"p"},"spin")," comes in handy in ",(0,i.kt)("a",{parentName:"p",href:"/metaflow/visualizing-results/effortless-task-inspection-with-default-cards#developing-cards-quickly-with-spin"},"visualizing results with ",(0,i.kt)("inlineCode",{parentName:"a"},"@card")),"."),(0,i.kt)("p",null,"You may use ",(0,i.kt)("inlineCode",{parentName:"p"},"spin")," programmatically using ",(0,i.kt)("a",{parentName:"p",href:"/metaflow/managing-flows/runner"},"the ",(0,i.kt)("inlineCode",{parentName:"a"},"Runner")," API"),",\nas described in the section about using ",(0,i.kt)("a",{parentName:"p",href:"/metaflow/authoring-flows/spin-input-output#using-spin-for-unit-testing"},(0,i.kt)("inlineCode",{parentName:"a"},"spin")," for unit testing"),". "),(0,i.kt)("h3",{id:"testing-a-step-with-past-results"},"Testing a step with past results"),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"You may need to upgrade your metadata service to allow ",(0,i.kt)("inlineCode",{parentName:"p"},"spin")," to find past results\nefficiently. The command will show a message about this if an upgrade is needed.")),(0,i.kt)("p",null,"By default, ",(0,i.kt)("inlineCode",{parentName:"p"},"spin")," executes the given step with artifacts originating from the latest\nrun in ",(0,i.kt)("a",{parentName:"p",href:"/scaling/tagging"},"the current namespace"),". Hence you can just ",(0,i.kt)("inlineCode",{parentName:"p"},"spin somestep"),"\nwithout having to worry about the input artifacts changing abruptly."),(0,i.kt)("p",null,"Optionally, you may spin a step using artifacts from any past run. Simply provide\nthe full pathspec of a task as an argument for ",(0,i.kt)("inlineCode",{parentName:"p"},"spin"),", like here:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"python myflow.py spin 32455/train/355\n")),(0,i.kt)("p",null,"In this case, ",(0,i.kt)("inlineCode",{parentName:"p"},"spin")," will re-execute the ",(0,i.kt)("inlineCode",{parentName:"p"},"train")," step in ",(0,i.kt)("inlineCode",{parentName:"p"},"myflow.py")," using the same\ninputs that were provided for the given task ",(0,i.kt)("inlineCode",{parentName:"p"},"32455/train/355"),"."),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"You can use ",(0,i.kt)("inlineCode",{parentName:"p"},"spin")," to test a step quickly with different inputs, since it can replay\nany past results. For example, if you have several previous runs with varying datasets\nor sample sizes, you can ",(0,i.kt)("inlineCode",{parentName:"p"},"spin")," the step against each one to see how it behaves with\ndiverse inputs.")),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Spin may not work properly on certain flows with conditionals. We are working on\nimproving this support.")))}d.isMDXComponent=!0}}]);