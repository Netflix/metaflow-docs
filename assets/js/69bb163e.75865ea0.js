"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[3709],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>f});var i=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=i.createContext({}),l=function(e){var t=i.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=l(e.components);return i.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,p=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=l(n),f=a,m=d["".concat(p,".").concat(f)]||d[f]||c[f]||r;return n?i.createElement(m,o(o({ref:t},u),{},{components:n})):i.createElement(m,o({ref:t},u))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=d;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var l=2;l<r;l++)o[l]=n[l];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9120:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var i=n(7462),a=(n(7294),n(3905));const r={},o="Spin Inputs And Outputs",s={unversionedId:"metaflow/authoring-flows/spin-input-output",id:"metaflow/authoring-flows/spin-input-output",title:"Spin Inputs And Outputs",description:"By default, spin uses artifacts from the most recent run as inputs.",source:"@site/docs/metaflow/authoring-flows/spin-input-output.md",sourceDirName:"metaflow/authoring-flows",slug:"/metaflow/authoring-flows/spin-input-output",permalink:"/metaflow/authoring-flows/spin-input-output",draft:!1,editUrl:"https://github.dev/Netflix/metaflow-docs/blob/master/docs/metaflow/authoring-flows/spin-input-output.md",tags:[],version:"current",frontMatter:{},sidebar:"python",previous:{title:"Authoring Flows Incrementally",permalink:"/metaflow/authoring-flows/introduction"},next:{title:"Managing Flows in Notebooks and Scripts",permalink:"/metaflow/managing-flows/introduction"}},p={},l=[{value:"Inspecting artifacts produced by <code>spin</code>",id:"inspecting-artifacts-produced-by-spin",level:2},{value:"Using <code>spin</code> for unit testing",id:"using-spin-for-unit-testing",level:3},{value:"Overriding input artifacts",id:"overriding-input-artifacts",level:2}],u={toc:l};function c(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,i.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"spin-inputs-and-outputs"},"Spin Inputs And Outputs"),(0,a.kt)("p",null,"By default, ",(0,a.kt)("inlineCode",{parentName:"p"},"spin")," uses artifacts from the most recent ",(0,a.kt)("inlineCode",{parentName:"p"},"run")," as inputs.\nIt doesn\u2019t produce any new artifacts, nor does it record metadata, making\nit ideal for quick, transient smoke tests which mainly focus on logs and\nerrors output on the console, as well as ",(0,a.kt)("inlineCode",{parentName:"p"},"@card"),"s."),(0,a.kt)("p",null,"However, you can optionally override inputs, even individual artifacts,\nand capture outputs for later inspection, as described below."),(0,a.kt)("h2",{id:"inspecting-artifacts-produced-by-spin"},"Inspecting artifacts produced by ",(0,a.kt)("inlineCode",{parentName:"h2"},"spin")),(0,a.kt)("p",null,"To persist artifacts for inspection, run ",(0,a.kt)("inlineCode",{parentName:"p"},"spin")," with the ",(0,a.kt)("inlineCode",{parentName:"p"},"--persist"),"\noption:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"python myflow.py spin train --persist\n")),(0,a.kt)("p",null,"After running ",(0,a.kt)("inlineCode",{parentName:"p"},"spin"),", you can inspect its artifacts using\n",(0,a.kt)("a",{parentName:"p",href:"/metaflow/client"},"the Client API"),". To do so, tell the Client to look at\nthe ephemeral results from ",(0,a.kt)("inlineCode",{parentName:"p"},"spin")," instead of the usual metadata service by\npointing it to the working directory that contains the results via\n",(0,a.kt)("inlineCode",{parentName:"p"},"inspect_spin"),", as shown below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'from metaflow import inspect_spin\n\ninspect_spin(".")\nFlow("TrainingFlow").latest_run["train"].task["model"].data\n')),(0,a.kt)("p",null,"This will fetch the results from a special local ",(0,a.kt)("inlineCode",{parentName:"p"},"./.metaflow_spin"),"\ndatastore. You can safely delete the ",(0,a.kt)("inlineCode",{parentName:"p"},".metaflow_spin")," directory when you\ndon't need the results anymore. Note that the ",(0,a.kt)("inlineCode",{parentName:"p"},'"."')," argument tells ",(0,a.kt)("inlineCode",{parentName:"p"},"inspect_spin")," which\ndirectory to look for the ",(0,a.kt)("inlineCode",{parentName:"p"},".metaflow_spin"),' directory in so you can also create multiple\n"spin" environments if you wish to.'),(0,a.kt)("p",null,"This way, you can quickly test and inspect artifacts without persisting\nanything in the main datastore permanently."),(0,a.kt)("h3",{id:"using-spin-for-unit-testing"},"Using ",(0,a.kt)("inlineCode",{parentName:"h3"},"spin")," for unit testing"),(0,a.kt)("p",null,"The above pattern makes ",(0,a.kt)("inlineCode",{parentName:"p"},"spin")," useful for unit testing of individual steps\ne.g. in a CI/CD pipeline."),(0,a.kt)("p",null,"In a unit testing script (e.g. using ",(0,a.kt)("inlineCode",{parentName:"p"},"pytest"),"), you can use\n",(0,a.kt)("a",{parentName:"p",href:"/metaflow/managing-flows/runner"},"the ",(0,a.kt)("inlineCode",{parentName:"a"},"Runner")," API")," to run ",(0,a.kt)("inlineCode",{parentName:"p"},"spin")," with\n",(0,a.kt)("inlineCode",{parentName:"p"},"persist=True")," to capture output artifacts, the correctness\nof which you can ",(0,a.kt)("inlineCode",{parentName:"p"},"assert")," on the step has completed, like here:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'from metaflow import Runner\n\nwith Runner("flow.py").spin("train", persist=True) as spin:\n  assert spin.task["model"].data == "kmeans"\n')),(0,a.kt)("p",null,"Running this command in different directories would create separate ",(0,a.kt)("inlineCode",{parentName:"p"},".metaflow_spin"),"\ndirectories thereby isolating your various tests."),(0,a.kt)("h2",{id:"overriding-input-artifacts"},"Overriding input artifacts"),(0,a.kt)("p",null,"As mentioned, ",(0,a.kt)("inlineCode",{parentName:"p"},"spin")," uses the exact same input artifacts as what were used\nin the latest run of the given step, or those of ",(0,a.kt)("a",{parentName:"p",href:"/metaflow/authoring-flows/introduction#testing-a-step-with-past-results"},"any past\nrun"),"."),(0,a.kt)("p",null,"You may, however, override any or all of the artifacts individually. This can\ncome in handy if you want to test your step code quickly with arbitrary inputs\non the fly. Since artifacts can be any Python objects, the overrides are defined\nas a special Python module (file) that contains a dictionary, ",(0,a.kt)("inlineCode",{parentName:"p"},"ARTIFACTS"),", like\nin this example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-python"},'ARTIFACTS = {\n  "model": "kmeans",\n  "k": 15\n}\n')),(0,a.kt)("p",null,"You can save this to a file, say, ",(0,a.kt)("inlineCode",{parentName:"p"},"artifacts.py"),", and run ",(0,a.kt)("inlineCode",{parentName:"p"},"spin")," as follows:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"python myflow.py spin train --artifacts-module artifacts.py\n")),(0,a.kt)("p",null,"In this case, the base set of artifacts is loaded from the latest run\n(since no explicit pathspec was provided on the command line), and two of them,\n",(0,a.kt)("inlineCode",{parentName:"p"},"model")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"k"),", are overridden by the module. In short, when looking for an artifact,\nMetaflow will first look in the ",(0,a.kt)("inlineCode",{parentName:"p"},"ARTIFACTS")," dictionary to see if the name it is looking\nfor is present, if so, it returns that value, if not, it will look in the artifacts\npassed down from the run specified."))}c.isMDXComponent=!0}}]);