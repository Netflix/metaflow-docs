"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[2305],{7823:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>s,metadata:()=>o,toc:()=>d});var n=t(7462),i=(t(7294),t(3905)),r=t(2004);const s={},l="Effortless Task Inspection with Default Cards",o={unversionedId:"metaflow/visualizing-results/effortless-task-inspection-with-default-cards",id:"metaflow/visualizing-results/effortless-task-inspection-with-default-cards",title:"Effortless Task Inspection with Default Cards",description:"Metaflow comes with a built-in Default Card that shows all artifacts produced by a",source:"@site/docs/metaflow/visualizing-results/effortless-task-inspection-with-default-cards.md",sourceDirName:"metaflow/visualizing-results",slug:"/metaflow/visualizing-results/effortless-task-inspection-with-default-cards",permalink:"/metaflow/visualizing-results/effortless-task-inspection-with-default-cards",draft:!1,editUrl:"https://github.dev/Netflix/metaflow-docs/blob/master/docs/metaflow/visualizing-results/effortless-task-inspection-with-default-cards.md",tags:[],version:"current",frontMatter:{},sidebar:"python",previous:{title:"Visualizing Results",permalink:"/metaflow/visualizing-results/"},next:{title:"Easy Custom Reports with Card Components",permalink:"/metaflow/visualizing-results/easy-custom-reports-with-card-components"}},c={},d=[{value:"Using Local Card Viewer",id:"using-local-card-viewer",level:2},{value:"Developing Cards Quickly with <code>spin</code>",id:"developing-cards-quickly-with-spin",level:3},{value:"Visualizing Artifacts with the Default Card",id:"visualizing-artifacts-with-the-default-card",level:2},{value:"Cards Are Stored And Versioned Automatically",id:"cards-are-stored-and-versioned-automatically",level:2},{value:"Accessing Cards via an API",id:"accessing-cards-via-an-api",level:2},{value:"Sharing Cards",id:"sharing-cards",level:2}],p={toc:d};function u(e){let{components:a,...s}=e;return(0,i.kt)("wrapper",(0,n.Z)({},p,s,{components:a,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"effortless-task-inspection-with-default-cards"},"Effortless Task Inspection with Default Cards"),(0,i.kt)("p",null,"Metaflow comes with a built-in ",(0,i.kt)("em",{parentName:"p"},"Default Card")," that shows all artifacts produced by a\ntask. Let\u2019s create a simple flow to test it."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"from metaflow import FlowSpec, Parameter, step, card\nfrom datetime import datetime\n\nclass DefaultCardFlow(FlowSpec):\n\n    alpha = Parameter('alpha', default=0.5)\n\n    @card\n    @step\n    def start(self):\n        self.example_dict = {'first_key': list(range(10)),\n                             'second_key': {'one', 'two'}}\n        self.timestamp = datetime.utcnow()\n        self.next(self.end)\n\n    @step\n    def end(self):\n        pass\n\nif __name__ == \"__main__\":\n    DefaultCardFlow()\n")),(0,i.kt)("p",null,"The only new feature introduced in this flow is the ",(0,i.kt)("inlineCode",{parentName:"p"},"@card")," decorator which attaches a\ncard to the ",(0,i.kt)("inlineCode",{parentName:"p"},"start")," step. Since no arguments are given to the decorator, the ",(0,i.kt)("em",{parentName:"p"},"Default\nCard")," is used. Save the example in ",(0,i.kt)("inlineCode",{parentName:"p"},"defaultcard.py")," and execute the flow as usual:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"python defaultcard.py run\n")),(0,i.kt)("p",null,"After the run has finished, you can open a generated card on the command line:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"python defaultcard.py card view start\n")),(0,i.kt)("p",null,"The command will open the card in your web browser. It will look like this:"),(0,i.kt)("p",null,(0,i.kt)("img",{src:t(4395).Z,width:"1020",height:"949"})),(0,i.kt)("p",null,"The ",(0,i.kt)("em",{parentName:"p"},"Default Card")," shows basic metadata about the task, parameters given for the flow,\nartifacts accessible in the task, as well as a visualization of the flow DAG. You can\nuse this information to quickly observe and verify results of a task without making any\nchanges in the code."),(0,i.kt)("h2",{id:"using-local-card-viewer"},"Using Local Card Viewer"),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Local Card Viewer was introduced in Metaflow 2.11. Make sure you have a recent\nenough version of Metaflow to use this feature.")),(0,i.kt)("p",null,"Opening a card manually after each run with ",(0,i.kt)("inlineCode",{parentName:"p"},"card view")," can get tedious. If you\nhave access to Metaflow UI, you can view cards automatically in the UI. If you\ndon't have the UI deployed, Metaflow provides a simple built-in viewer, ",(0,i.kt)("em",{parentName:"p"},"Local\nCard Viewer"),", which sets up a local server for viewing cards."),(0,i.kt)("p",null,"Open a new terminal, navigate to the same working directory where you will be executing\nflows, and run this command"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"python defaultcard.py card server\n")),(0,i.kt)("p",null,"In your browser, go to ",(0,i.kt)("a",{parentName:"p",href:"http://localhost:8324"},"localhost:8324"),". You should see the latest\ncard created with a header that allows you to navigate through all cards\nproduced by the latest run:"),(0,i.kt)("p",null,(0,i.kt)("img",{src:t(9677).Z,width:"1200",height:"489"})),(0,i.kt)("p",null,"If you run the flow again"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"python defaultcard.py run\n")),(0,i.kt)("p",null,"the viewer updates automatically to show the latest card. This way, you can keep the viewer\nopen on the side, as you develop your flows in another window. Importantly,\nthe local viewer allows you to view ",(0,i.kt)("a",{parentName:"p",href:"dynamic-cards"},"updating cards in real-time"),",\nsimilar to Metaflow UI, while the ",(0,i.kt)("inlineCode",{parentName:"p"},"card view")," command only shows a card that was\navailable at the time when you executed the command."),(0,i.kt)("h3",{id:"developing-cards-quickly-with-spin"},"Developing Cards Quickly with ",(0,i.kt)("inlineCode",{parentName:"h3"},"spin")),(0,i.kt)("p",null,"You can develop cards quickly by using ",(0,i.kt)("a",{parentName:"p",href:"/metaflow/authoring-flows/introduction"},"the\n",(0,i.kt)("inlineCode",{parentName:"a"},"spin")," command")," together with the local\ncard viewer, as shown in this short video:"),(0,i.kt)(r.Z,{controls:!0,url:"https://youtu.be/hoRO5eePjqo",mdxType:"ReactPlayer"}),(0,i.kt)("br",null),(0,i.kt)("p",null,"Run the local card viewer in a terminal using ",(0,i.kt)("inlineCode",{parentName:"p"},"--mode spin")," to watch\nephemeral spin results instead of the standard, persistent cards:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"python defaultcard.py --mode spin card server\n")),(0,i.kt)("p",null,"You can then use spin in another terminal to iterate on a step, viewing the results as cards in real time. Build the card content incrementally by adding artifacts and\n",(0,i.kt)("a",{parentName:"p",href:"/metaflow/visualizing-results/easy-custom-reports-with-card-components"},"card components"),", and quickly inspect your progress by running ",(0,i.kt)("inlineCode",{parentName:"p"},"spin")," after each change."),(0,i.kt)("h2",{id:"visualizing-artifacts-with-the-default-card"},"Visualizing Artifacts with the Default Card"),(0,i.kt)("p",null,"As shown in the screenshot above, the artifacts table shows all Metaflow artifacts\nrelated to the task. Large artifacts are truncated for display - you can access the\noriginals using ",(0,i.kt)("a",{parentName:"p",href:"../client"},"the Client API"),"."),(0,i.kt)("p",null,"If an artifact contains an image or a dataframe, the artifact is visualized in a\nseparate section in addition to its string representation. Take a look at the following\nexample which contains an artifact, ",(0,i.kt)("inlineCode",{parentName:"p"},"self.image")," storing an animated GIF and another\nartifact, a Pandas ",(0,i.kt)("inlineCode",{parentName:"p"},"dataframe"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"from metaflow import FlowSpec, Parameter, step\nimport requests, pandas, string\n\nURL = \"https://upload.wikimedia.org/wikipedia/commons/4/45/Blue_Marble_rotating.gif\"\n\nclass FancyDefaultCardFlow(FlowSpec):\n\n    image_url = Parameter('image_url', default=URL)\n\n    @step\n    def start(self):\n        self.image = requests.get(self.image_url,\n                                  headers={'user-agent': 'metaflow-example'}).content\n        self.dataframe = pandas.DataFrame({'lowercase': list(string.ascii_lowercase),\n                                           'uppercase': list(string.ascii_uppercase)})\n        self.next(self.end)\n\n    @step\n    def end(self):\n        pass\n\nif __name__ == \"__main__\":\n    FancyDefaultCardFlow()\n")),(0,i.kt)("p",null,"To demonstrate how cards can be attached to runs on the fly, this example doesn\u2019t\ninclude the ",(0,i.kt)("inlineCode",{parentName:"p"},"@card")," decorator in the code. Save the code to ",(0,i.kt)("inlineCode",{parentName:"p"},"fancydefaultcard.py")," and\nrun it as follows:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"python fancydefaultcard.py run --with card\n")),(0,i.kt)("p",null,"Note that the example expects that you have the ",(0,i.kt)("inlineCode",{parentName:"p"},"requests")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"pandas")," libraries\ninstalled. The ",(0,i.kt)("inlineCode",{parentName:"p"},"--with card")," option attaches a ",(0,i.kt)("inlineCode",{parentName:"p"},"@card")," decorator to every step without\nchanges in the code. You can execute any existing flow ",(0,i.kt)("inlineCode",{parentName:"p"},"--with card")," to inspect its\nresults visually."),(0,i.kt)("p",null,"You use the local viewer to see the card or open the card manually:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"python fancydefaultcard.py card view start\n")),(0,i.kt)("p",null,"You will see additional sections in the card which visualize ",(0,i.kt)("inlineCode",{parentName:"p"},"dataframe")," as a table and\nshow the image stored in the ",(0,i.kt)("inlineCode",{parentName:"p"},"image")," artifact."),(0,i.kt)("p",null,(0,i.kt)("img",{src:t(3101).Z,width:"1234",height:"857"})),(0,i.kt)("p",null,"Cards come with ",(0,i.kt)("a",{parentName:"p",href:"#"},"a built-in component, ",(0,i.kt)("inlineCode",{parentName:"a"},"VegaChart"),", for creating charts and plots"),",\nbut using the above pattern you can use any other visualization library and store\nthe resulting image in an artifact for easy viewing."),(0,i.kt)("h2",{id:"cards-are-stored-and-versioned-automatically"},"Cards Are Stored And Versioned Automatically"),(0,i.kt)("p",null,"A major benefit of ",(0,i.kt)("inlineCode",{parentName:"p"},"@card")," is that reports produced by it are versioned and stored in\nthe Metaflow datastore automatically, alongside their parent task. This way, you or\nyour colleagues can easily access any historical card, e.g. a model scorecard associated\nwith a particular version of the model."),(0,i.kt)("p",null,"All past cards are viewable in the Metaflow UI but you can also\naccess any historical card on the command line by using a run ID of a past run.\nFor instance"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"python fancydefaultcard.py card view 1638257165470922/start\n")),(0,i.kt)("p",null,"In the case of ",(0,i.kt)("a",{parentName:"p",href:"../basics#foreach"},"foreach"),", a single step can produce multiple tasks\nand cards. You can view an individual card by giving a full task ID (aka ",(0,i.kt)("em",{parentName:"p"},"pathspec"),")\ncorresponding to a task:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"python fancydefaultcard.py card view 1638257165470922/start/1\n")),(0,i.kt)("p",null,"You can see all available cards in the latest run with the ",(0,i.kt)("inlineCode",{parentName:"p"},"card list")," command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"python fancydefaultcard.py card list\n")),(0,i.kt)("p",null,"It is possible to produce multiple separate cards from a single task by adding multiple\n",(0,i.kt)("inlineCode",{parentName:"p"},"@card")," decorators in a step, which are all shown by ",(0,i.kt)("inlineCode",{parentName:"p"},"card list"),". To make it easier to\nidentify specific cards, you can also assign them a unique ID, as described in ",(0,i.kt)("a",{parentName:"p",href:"easy-custom-reports-with-card-components#multiple-cards-in-a-step"},"Multiple\nCards In a Step"),"."),(0,i.kt)("h2",{id:"accessing-cards-via-an-api"},"Accessing Cards via an API"),(0,i.kt)("p",null,"Besides the Metaflow UI and the command line interface, you can access and view cards\nprogrammatically through an API. This is particularly convenient, if you want to access cards,\nsay, in a Jupyter notebook."),(0,i.kt)("p",null,"Given a Task ID (a ",(0,i.kt)("em",{parentName:"p"},"pathspec"),"), or ",(0,i.kt)("a",{parentName:"p",href:"../client"},"a Task object from the Client API"),", the\n",(0,i.kt)("inlineCode",{parentName:"p"},"get_cards")," function lists all cards of the task. You can try this in a notebook cell.\nReplace the Task ID with an actual ID from a previous run:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"from metaflow.cards import get_cards\nget_cards('CountryModelFlow/1641937201798104/train_country_model/2')\n")),(0,i.kt)("p",null,"This will show the card in the output cell:"),(0,i.kt)("p",null,(0,i.kt)("img",{src:t(7241).Z,width:"1169",height:"444"})),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"get_cards")," function works well in conjunction with ",(0,i.kt)("a",{parentName:"p",href:"../client"},"the Client API"),". For\ninstance, you can use the Client API to search for a task with a specific artifact and\nview its card:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"run = Run('CountryModelFlow/1641937201798104')\n[brazil] = [task for task in run['train_country_model']\n            if task['country'].data == 'Brazil']\nget_cards(brazil)\n")),(0,i.kt)("p",null,(0,i.kt)("img",{src:t(5821).Z,width:"1127",height:"485"})),(0,i.kt)("h2",{id:"sharing-cards"},"Sharing Cards"),(0,i.kt)("p",null,"Since cards are self-contained HTML files, they can be easily shared and viewed by\nanyone without having to install additional software. To share a card, first save the\ndesired card to a file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"python fancydefaultcard.py card get start mycard.html\n")),(0,i.kt)("p",null,"Use the ",(0,i.kt)("inlineCode",{parentName:"p"},"card get")," command to save the HTML without opening it in a browser. You can\nattach the resulting card file, here ",(0,i.kt)("inlineCode",{parentName:"p"},"mycard.html"),", say, in an email or a Slack message.\nIf you want to share reports automatically e.g. via email, you can use the ",(0,i.kt)("inlineCode",{parentName:"p"},"get_cards"),"\nAPI discussed above to obtain the HTML programmatically."),(0,i.kt)("p",null,"Some recipients may prefer a PDF file over HTML. In this case, you can simply choose\n\u201cPrint\u201d in your browser followed by \u201cSave as PDF\u201d."))}u.isMDXComponent=!0},5821:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/card-docs-clientapi-2bc75c5febc429054290e5d17577e71c.png"},4395:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/card-docs-defaultcard-c8b2f549e1fac6e9bd0422737d355011.png"},3101:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/card-docs-fancydefaultcard-c2bfe6b1e8fb64a195188fb844d6eb7d.png"},7241:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/card-docs-notebook-efdbb4e78e8dc80c3c53cb0a62aa914d.png"},9677:(e,a,t)=>{t.d(a,{Z:()=>n});const n=t.p+"assets/images/card-local-viewer-86bc522d16e49f6d05fbfa34fe50b834.png"}}]);