"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[6772],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>m});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=a.createContext({}),s=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=s(e.components);return a.createElement(p.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,i=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=s(t),m=r,y=d["".concat(p,".").concat(m)]||d[m]||c[m]||i;return t?a.createElement(y,o(o({ref:n},u),{},{components:t})):a.createElement(y,o({ref:n},u))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=t.length,o=new Array(i);o[0]=d;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var s=2;s<i;s++)o[s]=t[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},4181:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>o,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>s});var a=t(7462),r=(t(7294),t(3905));const i={},o="Using uv",l={unversionedId:"scaling/dependencies/uv",id:"scaling/dependencies/uv",title:"Using uv",description:"uv is a fast, modern Python package manager designed for creating reproducible environments with minimal overhead. In Metaflow, you can use projects managed by uv directly by",source:"@site/docs/scaling/dependencies/uv.md",sourceDirName:"scaling/dependencies",slug:"/scaling/dependencies/uv",permalink:"/scaling/dependencies/uv",draft:!1,editUrl:"https://github.dev/Netflix/metaflow-docs/blob/master/docs/scaling/dependencies/uv.md",tags:[],version:"current",frontMatter:{},sidebar:"python",previous:{title:"Managing Libraries",permalink:"/scaling/dependencies/libraries"},next:{title:"Conda vs. PyPI",permalink:"/scaling/dependencies/conda-vs-pypi"}},p={},s=[{value:"Setting up a Metaflow project with <code>uv</code>",id:"setting-up-a-metaflow-project-with-uv",level:2},{value:"Running tasks remotely",id:"running-tasks-remotely",level:2}],u={toc:s};function c(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"using-uv"},"Using uv"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/astral-sh/uv"},(0,r.kt)("inlineCode",{parentName:"a"},"uv")," is a fast, modern Python package manager")," designed for creating reproducible environments with minimal overhead. In Metaflow, you can use projects managed by ",(0,r.kt)("inlineCode",{parentName:"p"},"uv")," directly by\nspecifying ",(0,r.kt)("inlineCode",{parentName:"p"},"--environment=uv"),", enabling you to manage dependencies the same way you would in any contemporary Python project. This makes it easy to develop locally and seamlessly run flows in the cloud with all dependencies included."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"uv")," takes a more holistic approach to package and project management in contrast to ",(0,r.kt)("inlineCode",{parentName:"p"},"conda")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"pip"),". As a result,\nwhen using ",(0,r.kt)("inlineCode",{parentName:"p"},"--environment=uv"),", Metaflow lets ",(0,r.kt)("inlineCode",{parentName:"p"},"uv")," install and handle dependencies using its native approach.\nA downside of this is that ",(0,r.kt)("inlineCode",{parentName:"p"},"uv")," doesn't benefit from ",(0,r.kt)("a",{parentName:"p",href:"/scaling/dependencies/internals"},"Metaflow's internal package snapshotting")," which provides stronger guarantees for scalability and availability of packages, which matters especially\nwhen running tasks at large scale."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("inlineCode",{parentName:"p"},"uv")," is often a convenient starting point. If you run into any issues at scale, you can always switch to ",(0,r.kt)("inlineCode",{parentName:"p"},"@pypi"),"\nor ",(0,r.kt)("inlineCode",{parentName:"p"},"@conda")," later.")),(0,r.kt)("h2",{id:"setting-up-a-metaflow-project-with-uv"},"Setting up a Metaflow project with ",(0,r.kt)("inlineCode",{parentName:"h2"},"uv")),(0,r.kt)("p",null,"Metaflow works with ",(0,r.kt)("inlineCode",{parentName:"p"},"uv")," as any other Python library, so you can use ",(0,r.kt)("inlineCode",{parentName:"p"},"uv")," as usual. Here's an example:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Initialize a project: ",(0,r.kt)("inlineCode",{parentName:"p"},"uv init myflow; cd myflow"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add packages you need, including Metaflow: ",(0,r.kt)("inlineCode",{parentName:"p"},"uv add pandas metaflow"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Run a flow ",(0,r.kt)("inlineCode",{parentName:"p"},"uv run flow.py run"),"."))),(0,r.kt)("h2",{id:"running-tasks-remotely"},"Running tasks remotely"),(0,r.kt)("p",null,"Metaflow will package and ship the ",(0,r.kt)("inlineCode",{parentName:"p"},"uv")," project in the cloud when you specify ",(0,r.kt)("inlineCode",{parentName:"p"},"--environment=uv"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"uv run flow.py --environment=uv run\n")),(0,r.kt)("p",null,"Or, more conveniently, you can set an environment variable"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"export METAFLOW_ENVIRONMENT=uv\n")),(0,r.kt)("p",null,"so you don't need to add the command line option in every execution."),(0,r.kt)("p",null,"After this, you can use Metaflow's compute layer to ",(0,r.kt)("a",{parentName:"p",href:"/scaling/remote-tasks/requesting-resources"},"run the flow in the cloud")," with all the packages defined in your ",(0,r.kt)("inlineCode",{parentName:"p"},"uv")," environment included, e.g. ",(0,r.kt)("a",{parentName:"p",href:"/scaling/remote-tasks/kubernetes"},"using Kubernetes")," (",(0,r.kt)("a",{parentName:"p",href:"/scaling/remote-tasks/aws-batch"},"or ",(0,r.kt)("inlineCode",{parentName:"a"},"--with batch")),"):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"uv run flow.py run --with kubernetes\n")),(0,r.kt)("p",null,"Remember to set the ",(0,r.kt)("inlineCode",{parentName:"p"},"environment=uv")," when ",(0,r.kt)("a",{parentName:"p",href:"/production/introduction"},"deploying to production")," as well."))}c.isMDXComponent=!0}}]);