<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-metaflow/configuring-flows/config-driven-experimentation">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EYFXNGNGB6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-EYFXNGNGB6",{anonymize_ip:!0})</script><title data-rh="true">Config-Driven Experimentation | Metaflow Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.metaflow.org/img/og-metaflow.png"><meta data-rh="true" name="twitter:image" content="https://docs.metaflow.org/img/og-metaflow.png"><meta data-rh="true" property="og:url" content="https://docs.metaflow.org/metaflow/configuring-flows/config-driven-experimentation"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="og:width" content="200"><meta data-rh="true" name="og:height" content="126"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Config-Driven Experimentation | Metaflow Docs"><meta data-rh="true" name="description" content="Usually, a Config determines how a run should behave. It is also possible to use configs, in"><meta data-rh="true" property="og:description" content="Usually, a Config determines how a run should behave. It is also possible to use configs, in"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.metaflow.org/metaflow/configuring-flows/config-driven-experimentation"><link data-rh="true" rel="alternate" href="https://docs.metaflow.org/metaflow/configuring-flows/config-driven-experimentation" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.metaflow.org/metaflow/configuring-flows/config-driven-experimentation" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://5IZ8L9TJQL-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.57e5c9db.css">
<link rel="preload" href="/assets/js/runtime~main.46b91267.js" as="script">
<link rel="preload" href="/assets/js/main.f9ec58aa.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_jvwV"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/Metaflow_Logo_Horizontal_OneColor_DarkBlue_RGB.svg" alt="Metaflow Logo" class="themedImage_ToTc themedImage--light_HNdA" height="30"><img src="/img/Metaflow_Logo_Horizontal_OneColor_White_RGB.svg" alt="Metaflow Logo" class="themedImage_ToTc themedImage--dark_i4oU" height="30"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Documentation</a><a href="https://outerbounds.com/docs/admin" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Deployment Guide<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div style="display:flex;align-items:center"><div class="responsivePadding_cpaU" style="display:flex;align-items:center;gap:0.75rem"><a href="https://github.com/Netflix/metaflow" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><img src="/img/github.svg" alt="GitHub" class="logo_v_H3 githubLogo"></a><a href="http://slack.outerbounds.co/" target="_blank" rel="noopener noreferrer" aria-label="Slack"><img class="logo_v_H3" src="/img/slack.svg" alt="Slack"></a></div><div class="toggle_vylO colorModeToggle_x44X"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/Metaflow_Logo_Horizontal_OneColor_DarkBlue_RGB.svg" alt="Metaflow Logo" class="themedImage_ToTc themedImage--light_HNdA" height="30"><img src="/img/Metaflow_Logo_Horizontal_OneColor_White_RGB.svg" alt="Metaflow Logo" class="themedImage_ToTc themedImage--dark_i4oU" height="30"></a><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Welcome to Metaflow</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/introduction/why-metaflow">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/getting-started/install">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/metaflow/introduction">Developing Flows</a><button aria-label="Toggle the collapsible sidebar category &#x27;Developing Flows&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/metaflow/basics">Creating Flows</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/metaflow/client">Inspecting Flows and Results</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/metaflow/managing-flows/introduction">Managing Flows</a><button aria-label="Toggle the collapsible sidebar category &#x27;Managing Flows&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/metaflow/debugging">Debugging Flows</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/metaflow/visualizing-results">Visualizing Results</a><button aria-label="Toggle the collapsible sidebar category &#x27;Visualizing Results&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/metaflow/configuring-flows/introduction">Configuring Flows</a><button aria-label="Toggle the collapsible sidebar category &#x27;Configuring Flows&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/metaflow/configuring-flows/basic-configuration">Basic Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/metaflow/configuring-flows/parsing-configs">Parsing Configs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/metaflow/configuring-flows/custom-parsers">Custom Config Parsers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/metaflow/configuring-flows/config-driven-experimentation">Config-Driven Experimentation</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/scaling/introduction">Scaling Flows</a><button aria-label="Toggle the collapsible sidebar category &#x27;Scaling Flows&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/production/introduction">Deploying to Production</a><button aria-label="Toggle the collapsible sidebar category &#x27;Deploying to Production&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/api">API Reference</a><button aria-label="Toggle the collapsible sidebar category &#x27;API Reference&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/internals/release-notes">Internals of Metaflow</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/metaflow/introduction"><span itemprop="name">Developing Flows</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/metaflow/configuring-flows/introduction"><span itemprop="name">Configuring Flows</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Config-Driven Experimentation</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Config-Driven Experimentation</h1><p>Usually, a <code>Config</code> determines <em>how</em> a run should behave. It is also possible to use configs, in
conjunction with a configuration manager such as <a href="https://hydra.cc" target="_blank" rel="noopener noreferrer">Hydra</a>, to use configs to define
<em>what</em> should be run.</p><p>Hydra enables you to define and generate configuration sets that parameterize an entire suite of
Metaflow runs. By using configs, you can easily set up experiments and (hyper)parameter sweeps.
With the help of <a href="/metaflow/managing-flows/introduction">Metaflow&#x27;s <code>Runner</code> and <code>Deployer</code> APIs</a>, these runs
can be executed automatically.</p><p>This section gives two examples demonstrating the idea in practice:</p><ol><li><p>A benchmark template that allows you to choose what to run on the command line
(<a href="https://github.com/outerbounds/config-examples/tree/main/hydra-benchmark" target="_blank" rel="noopener noreferrer">source</a>).</p></li><li><p>A large-scale parameter sweep with real-time monitoring
(<a href="https://github.com/outerbounds/config-examples/tree/main/hydra-sweep" target="_blank" rel="noopener noreferrer">source</a>).</p></li></ol><p>Clone the examples from the source repository and follow along.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>You can run ordinary <a href="https://docs.outerbounds.com/grid-search-with-metaflow/" target="_blank" rel="noopener noreferrer">hyperparameter sweeps easily using
<code>foreach</code></a>. The examples in this section
cover a more advanced case where you need to alter flow-level behavior, decorators in particular,
in experiments. <a href="/metaflow/basics#foreach">Start with <code>foreach</code></a> and come back here if it
isn&#x27;t sufficient for your needs.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="benchmark-a-templatized-flow-with-pluggable-modules">Benchmark: A templatized flow with pluggable modules<a class="hash-link" href="#benchmark-a-templatized-flow-with-pluggable-modules" title="Direct link to heading">​</a></h2><p>Consider the following common scenario: You want to compare the performance of various
implementations across a common test setup. It should be easy to add new solutions without
having to modify the benchmarking setup itself. </p><p><a href="https://github.com/outerbounds/config-examples/tree/main/hydra-benchmark" target="_blank" rel="noopener noreferrer">Our example</a>
demonstrates the idea by measuring the performance of a simple dataframe operation -
grouping by hour - across three dataframe backends, Pandas, Polars, and DuckDB. Adding
a new backend is easy: Simply drop a module in <a href="https://github.com/outerbounds/config-examples/tree/main/hydra-benchmark/backend" target="_blank" rel="noopener noreferrer">the <code>backend</code>
directory</a>
with a config file that specifies the dependencies needed.</p><p>Thanks to <code>Config</code>, <a href="https://github.com/outerbounds/config-examples/blob/main/hydra-benchmark/benchmark_flow.py" target="_blank" rel="noopener noreferrer">the shared benchmark flow,
<code>ConfigurableBenchmark</code></a>, can modify its <code>@pypi</code> to match the requirements of the chosen backend, <a href="https://github.com/outerbounds/config-examples/blob/main/hydra-benchmark/benchmark_flow.py#L14" target="_blank" rel="noopener noreferrer">importing
the backend module on the
fly</a>.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>Besides Hydra, this pattern of pluggable modules, imported on the fly with custom dependencies
is useful in various applications. You can use it for pluggable feature encoders, models etc.</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="running-with-hydra">Running with Hydra<a class="hash-link" href="#running-with-hydra" title="Direct link to heading">​</a></h3><p>Imagine you want to compare the performance of the backends. You could run
<code>ConfigurableBenchmark</code> three times, choosing a suitable config manually but as the number of
backends increases, this can become tedious.</p><p>Managing experiments like this is where Hydra shines. We implement <a href="https://github.com/outerbounds/config-examples/blob/main/hydra-benchmark/benchmark_runner.py" target="_blank" rel="noopener noreferrer">a simple Hydra
app</a>
which uses <a href="/metaflow/managing-flows/runner">the Metaflow <code>Runner</code></a> to launch and manage a run.
We can then use the versatile syntax of Hydra to choose which experiments to run, letting Hydra
take care of merging each backend-specific config with <a href="https://github.com/outerbounds/config-examples/blob/main/hydra-benchmark/config.yaml" target="_blank" rel="noopener noreferrer">a global
config</a>
automatically.</p><p>The resulting setup looks like this:</p><p><img loading="lazy" src="/assets/images/hydra-runner-c4df95970a7c9f284f32d453e845ace6.png" width="1500" height="448" class="img_ev3q"></p><p>As experiments are managed by Hydra, instead of running a flow directly, we launch them via
the Hydra app. For instance, we can test a specific backend like this:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python bechmark_runner.py +backend=pandas</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Take a look at <a href="https://hydra.cc/docs/intro/" target="_blank" rel="noopener noreferrer">the documentation of Hydra</a> for details about
its rich syntax for configuring experiments. In particular, we can use Hydra to run multiple
experiments using its <a href="https://hydra.cc/docs/tutorials/basic/running_your_app/multi-run/" target="_blank" rel="noopener noreferrer">Multirun
mode</a>. We can use it to
test all backends sequentially:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python bechmark_runner.py +backend=pandas,polars,duckdb -m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The runner assigns a unique <a href="/metaflow/client#adding-removing-and-replacing-tags">Metaflow tag</a> in
a set of experiments, making it easy to focus and fetch results of a Hydra run. You can see the
command in action here (spoiler: DuckDB is fast!):</p><div style="width:100%;height:100%"></div><p>Note that <a href="https://github.com/outerbounds/config-examples/blob/main/hydra-benchmark/config.yaml#L7" target="_blank" rel="noopener noreferrer">the default
configuration</a>
includes a <code>remote: batch</code> key, which runs the experiments using <code>@batch</code>. You can remove the
<code>remote</code> line to execute the tests locally, or you can change it to <code>kubernetes</code>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="sweep-orchestrating-and-observing-experiments-at-scale">Sweep: Orchestrating and observing experiments at scale<a class="hash-link" href="#sweep-orchestrating-and-observing-experiments-at-scale" title="Direct link to heading">​</a></h2><p>The benchmark example above relied on a finite set of manually defined configurations, one for each
backend. In contrast, <a href="https://github.com/outerbounds/config-examples/tree/main/hydra-sweep" target="_blank" rel="noopener noreferrer">this example,
<code>hydra-sweep</code></a>,
generates a set of configurations on the fly, sweeping over a grid of quantitative parameters.</p><p>Typically, you would use a <code>foreach</code> to sweep over a parameter grid, but if the experiments
require changes in decorators, Hydra comes in handy again, thanks to its native support for
<a href="https://hydra.cc/docs/patterns/configuring_experiments/#sweeping-over-experiments" target="_blank" rel="noopener noreferrer">sweeping over experiments</a>.
Since the parameter grid can be large, it is not convenient to run experiments sequentially as with <code>hydra-benchmark</code>.
While we could parallelize experiments in a limited fashion on our local workstation, a more robust solution
for large-scale experimentation is to deploy experiments to one of the <a href="/production/scheduling-metaflow-flows/introduction">production
orchestrators supported by Metaflow</a>, which allows us
to run hundreds of large-scale experiments in parallel.</p><p>We follow a similar pattern as with <code>hydra-benchmark</code> above, constructing <a href="https://github.com/outerbounds/config-examples/blob/main/hydra-sweep/sweep_deployer.py" target="_blank" rel="noopener noreferrer">a Hydra app,
<code>sweep_deployer.py</code></a> that
deploys flows using <a href="/metaflow/managing-flows/deployer">the <code>Deployer</code> API</a>. We take extra care of
isolating deployments using <a href="/production/coordinating-larger-metaflow-projects"><code>@project</code> branches</a>,
so multiple sets of experiments can be run concurrently. </p><p>We attach a unique tag to all runs, which allows us to fetch all results for analysis and visualization.
This is done by
<a href="https://github.com/outerbounds/config-examples/blob/main/hydra-sweep/sweep_analytics.py" target="_blank" rel="noopener noreferrer"><code>SweepAnalyticsFlow</code></a>
which updates its results automatically through a <code>@trigger</code> every time an experiment finishes successfully.</p><p>The setup looks like this:</p><p><img loading="lazy" src="/assets/images/hydra-deployer-ba2e023f1f022e657933e01d7d17f3bc.png" width="1333" height="769" class="img_ev3q"></p><p>This pattern is applicable to any experiment that requires sweeping over configurations. To demonstrate the
idea in practice, we use a flow,
<a href="https://github.com/outerbounds/config-examples/blob/main/hydra-sweep/torchtest.py" target="_blank" rel="noopener noreferrer"><code>TorchPerfFlow</code></a>, to
test the performance of PyTorch doing a matrix squaring operation on a varying number of CPU cores, over
a varying dimensionality of the matrix - the sweep over these parameters is defined in <a href="https://github.com/outerbounds/config-examples/blob/main/hydra-sweep/config.yaml#L12" target="_blank" rel="noopener noreferrer">this Hydra
config</a>.
We adjust the <code>@resources(cpu=)</code> setting through the config, which wouldn&#x27;t be doable
using a normal <code>foreach</code>.</p><p>You can start the sweep, assuming you have Metaflow configured to work with Argo Workflows, by executing</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python sweep_deployer.py -m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It will start by deploying <code>SweepAnalyticsFlow</code>, followed by each individual <code>TorchPerfTest</code> experiment
which will produce statistics in real-time. As shown in the screen recording below, you can observe results
through <code>SweepAnalyticsFlow</code> that updates every time new data points appear:</p><div style="width:100%;height:100%"></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.dev/Netflix/metaflow-docs/blob/master/docs/metaflow/configuring-flows/config-driven-experimentation.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/metaflow/configuring-flows/custom-parsers"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Custom Config Parsers</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/scaling/introduction"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Scalable Compute and Data</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#benchmark-a-templatized-flow-with-pluggable-modules" class="table-of-contents__link toc-highlight">Benchmark: A templatized flow with pluggable modules</a><ul><li><a href="#running-with-hydra" class="table-of-contents__link toc-highlight">Running with Hydra</a></li></ul></li><li><a href="#sweep-orchestrating-and-observing-experiments-at-scale" class="table-of-contents__link toc-highlight">Sweep: Orchestrating and observing experiments at scale</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.46b91267.js"></script>
<script src="/assets/js/main.f9ec58aa.js"></script>
</body>
</html>