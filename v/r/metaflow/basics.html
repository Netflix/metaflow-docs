<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-v/r/metaflow/basics">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EYFXNGNGB6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-EYFXNGNGB6",{anonymize_ip:!0})</script><title data-rh="true">Basics of Metaflow | Metaflow Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.metaflow.org/img/og-metaflow.png"><meta data-rh="true" name="twitter:image" content="https://docs.metaflow.org/img/og-metaflow.png"><meta data-rh="true" property="og:url" content="https://docs.metaflow.org/v/r/metaflow/basics"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="og:width" content="200"><meta data-rh="true" name="og:height" content="126"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Basics of Metaflow | Metaflow Docs"><meta data-rh="true" name="description" content="This document introduces the basic concepts of Metaflow. If you are eager to try out"><meta data-rh="true" property="og:description" content="This document introduces the basic concepts of Metaflow. If you are eager to try out"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.metaflow.org/v/r/metaflow/basics"><link data-rh="true" rel="alternate" href="https://docs.metaflow.org/v/r/metaflow/basics" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.metaflow.org/v/r/metaflow/basics" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://5IZ8L9TJQL-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.3a1f2e37.css">
<link rel="preload" href="/assets/js/runtime~main.e3449fb1.js" as="script">
<link rel="preload" href="/assets/js/main.591a0229.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/Metaflow_Logo_Horizontal_OneColor_DarkBlue_RGB.svg" alt="Metaflow Logo" class="themedImage_ToTc themedImage--light_HNdA" height="30"><img src="/img/Metaflow_Logo_Horizontal_OneColor_White_RGB.svg" alt="Metaflow Logo" class="themedImage_ToTc themedImage--dark_i4oU" height="30"></div></a><a class="navbar__item navbar__link" href="/">Python Docs</a><a class="navbar__item navbar__link" href="/v/r">R Docs</a><a href="https://outerbounds.com/docs/admin" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Admin Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Basics of Metaflow</h1><p>This document introduces the basic concepts of Metaflow. If you are eager to try out
Metaflow in practice, you can start with the <a href="/v/r/getting-started/tutorials">tutorial</a>.
After the tutorial, you can return to this document to learn more about how Metaflow
works.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="the-structure-of-metaflow-code">The Structure of Metaflow Code<a class="hash-link" href="#the-structure-of-metaflow-code" title="Direct link to heading">​</a></h2><p>Metaflow follows <a href="https://en.wikipedia.org/wiki/Dataflow_programming" target="_blank" rel="noopener noreferrer">the dataflow
paradigm</a> which models a program as
a directed graph of operations. This is a natural paradigm for expressing data
processing pipelines, machine learning in particular.</p><p>We call the graph of operations <strong>a flow</strong>. You define the operations, called <strong>steps</strong>,
which are nodes of the graph and contain transitions to the next steps, which serve as
edges.</p><p>Metaflow sets some constraints on the structure of the graph. For starters, every flow
needs a step called <code>start</code> and a step called <code>end</code>. An execution of the flow, which we
call <strong>a run</strong>, starts at <code>start</code>. The run is successful if the final <code>end</code> step
finishes successfully.</p><p>What happens between <code>start</code> and <code>end</code> is up to you. You can construct the graph in
between using an arbitrary combination of the following three types of transitions
supported by Metaflow:</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="linear">Linear<a class="hash-link" href="#linear" title="Direct link to heading">​</a></h3><p>The most basic type of transition is <strong>a linear</strong> transition. It moves from one step to
another one.</p><p>Here is a graph with two linear transitions:</p><p><img loading="lazy" src="data:image/png;base64,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" width="389" height="82" class="img_ev3q"></p><p>The corresponding Metaflow script looks like this:</p><div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">myflow.R</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">library(metaflow)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start &lt;- function(self){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self$my_var &lt;- &quot;hello world&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a &lt;- function(self){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(paste(&quot;the data artifact is&quot;, self$my_var))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end &lt;- function(self){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(&quot;End of the linear flow&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metaflow(&quot;LinearFlow&quot;) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    step(step=&quot;start&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         r_function=start,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         next_step=&quot;a&quot;) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    step(step=&quot;a&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         r_function=a,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         next_step=&quot;end&quot;) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    step(step=&quot;end&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         r_function=end) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    run()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can execute this directly in your RStudio IDE or via the terminal:</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Terminal</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">RStudio</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Rscript myflow.R run</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Execute as is</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p>Besides executing the steps <code>start</code>, <code>a</code>, and <code>end</code> in order, this flow creates <strong>a data
artifact</strong> called <code>my_var</code>. In Metaflow, data artifacts are created simply by assigning
values to <code>$</code>-indexed variables under the <code>self</code> object such as <code>self$my_var</code>.</p><p>Data artifacts are available in all steps after they have been created, so they behave
like any normal instance variables. An exception to this rule is branching, as explained
below.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="branch">Branch<a class="hash-link" href="#branch" title="Direct link to heading">​</a></h3><p>You can express parallel steps with <strong>a branch</strong>. In the figure below, <code>start</code>
transitions to two parallel steps, <code>a</code> and <code>b</code>. Any number of parallel steps are
allowed. A benefit of a branch like this is performance: Metaflow can execute <code>a</code> and
<code>b</code> over multiple CPU cores or over multiple instances in the cloud.</p><div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">library(metaflow)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a &lt;- function(self){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self$var &lt;- 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b &lt;- function(self){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self$var &lt;- 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">join &lt;- function(self, inputs){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(paste(&quot;var in step a is&quot;, inputs$a$var))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(paste(&quot;var in step b is&quot;, inputs$b$var))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metaflow(&quot;BranchFlow&quot;) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    step(step = &quot;start&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         next_step = c(&quot;a&quot;, &quot;b&quot;)) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    step(step = &quot;a&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         r_function=a,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         next_step=&quot;join&quot;) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    step(step=&quot;b&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         r_function=b,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         next_step=&quot;join&quot;) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    step(step=&quot;join&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         r_function=join,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         next_step=&quot;end&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         join=TRUE) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    step(step=&quot;end&quot;) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    run()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Every branch must be joined. The join step does not need to be called <code>join</code> as above
but it must take an extra argument, like <code>inputs</code> above.</p><p>In the example above, the value of <code>var</code> above is ambiguous: <code>a</code> sets it to <code>1</code> and <code>b</code>
to <code>2</code>. To disambiguate the branches, the join step can refer to a specific step in the
branch, like <code>inputs$a$var</code> above. For convenience, you can also iterate over all steps
in the branch using <code>inputs</code>, which is simply a list. For more details, see the section
about <a href="/v/r/metaflow/basics#data-flow-through-the-graph">data flow through the graph</a>.</p><p>Note that you can nest branches arbitrarily, that is, you can branch inside a branch.
Just remember that all branches must have a corresponding join.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="foreach">Foreach<a class="hash-link" href="#foreach" title="Direct link to heading">​</a></h3><p>Static branches, as shown in the previous section are useful when you know the branches
at development time. Alternatively, you may want to branch based on data dynamically.
This is the use case for <strong>a foreach</strong> branch.</p><p>Foreach works likes the branch construct above but instead of creating named step
methods, many parallel copies of steps inside a foreach loop are executed.</p><p>A foreach loop can iterate over any list like <code>params</code> below.</p><div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">library(metaflow)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start &lt;- function(self){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self$params &lt;- c(&quot;param1&quot;, &quot;param2&quot;, &quot;param3&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a &lt;- function(self){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self$result &lt;- paste(self$input, &quot;processed&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">join &lt;- function(self, inputs){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    results &lt;- gather_inputs(inputs, &quot;result&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(results)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metaflow(&quot;ForeachFlow&quot;) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    step(step = &quot;start&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         r_function = start,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         next_step = &quot;a&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         foreach=&quot;params&quot;) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    step(step = &quot;a&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         r_function=a,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         next_step=&quot;join&quot;) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    step(step=&quot;join&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         r_function=join,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         next_step=&quot;end&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         join=TRUE) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    step(step=&quot;end&quot;) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    run()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The foreach loop is initialized by specifying a keyword argument <code>foreach</code> in <code>step</code>.
The <code>foreach</code> argument takes a string that is the name of a list stored in an <code>self$</code>
variable, like <code>params</code> above.</p><p>Steps inside a foreach loop create separate <strong>tasks</strong> to process each item of the list.
Here, Metaflow creates three parallel tasks for the step <code>a</code> to process the three items
of the <code>params</code> list in parallel. You can access the specific item assigned to a task
with an <code>self$</code> variable called <code>input</code>.</p><p>Foreach loops must be joined like static branches. Note that tasks inside a foreach loop
are not named, so you can only iterate over them with <code>inputs</code>. If you want, you can
assign a value to an <code>self$</code> variable in a foreach step which helps you to identify the
task.</p><p>You can nest foreaches and combine them with branches and linear steps arbitrarily.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="what-should-be-a-step">What should be a step?<a class="hash-link" href="#what-should-be-a-step" title="Direct link to heading">​</a></h2><p>There is not a single right way of structuring code as a graph of steps but here are
some best practices that you can follow.</p><p>Metaflow treats steps as indivisible units of execution. That is, a step either succeeds
or fails as a whole. After the step has finished successfully, Metaflow persists all
instance variables that were created in the step code, so the step does not have to be
executed again even if a subsequent step fails. In other words, you can inspect data
artifacts that were present when the step finished, but you can not inspect data that
were manipulated within a step.</p><p>This makes a step <a href="https://en.wikipedia.org/wiki/Application_checkpointing" target="_blank" rel="noopener noreferrer">a
checkpoint</a>. The more granular
your steps are, the more control you have over inspecting results and resuming failed
runs.</p><p>A downside of making steps too granular is that checkpointing adds some overhead. It
would not make sense to execute each line of code as a separate step. Keep your steps
small but not too small. A good rule of thumb is that a single step should not take more
than an hour to run, preferably much less than that.</p><p>Another important consideration is the readability of your code. Try running</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Terminal</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">RStudio</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Rscript myflow.R show</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Replace run() in myflow.R with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># run(show = TRUE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># and execute in RStudio</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p>which prints out the steps of your flow. Does the overview give you a good idea of your
code? If the steps are too broad, it might make sense to split them up just to make the
overall flow more descriptive.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-to-define-parameters-for-flows">How to define parameters for flows?<a class="hash-link" href="#how-to-define-parameters-for-flows" title="Direct link to heading">​</a></h2><p>Here is an example of a flow that defines a parameter, <code>alpha</code>:</p><div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">parameter_flow.R</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">library(metaflow)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start &lt;- function(self){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(paste(&quot;alpha is&quot;, self$alpha))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end &lt;- function(self){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(paste(&quot;alpha still is&quot;, self$alpha))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metaflow(&quot;ParameterFlow&quot;) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parameter(&quot;alpha&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              help=&quot;learning rate&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              required = TRUE) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    step(step=&quot;start&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         r_function=start,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         next_step=&quot;end&quot;) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    step(step=&quot;end&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         r_function=end) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    run()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Parameters are defined by using the method <code>parameter</code> . Parameter variables are
automatically available in all steps, like <code>alpha</code> above.</p><p>You can set the parameter values on the command line as follows:</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Terminal</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">RStudio</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Rscript parameter_flow.R run --alpha </span><span class="token number" style="color:#36acaa">0.6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Replace run() in parameter_flow.R with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># run(alpha = 0.6)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># and execute in RStudio</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p>You can see available parameters with:</p><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Terminal</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">RStudio</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Rscript parameter_flow.R run --help</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Replace run() in parameter_flow.R with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># run(help = TRUE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># and execute in RStudio</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div><p>Parameters are typed based on the type of their default value. If there is no meaningful
default for a parameter, you can define it as follows:</p><div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">parameter(&quot;num_components&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          help=&quot;Number of components&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          required=TRUE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          type=&quot;int&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now the flow can not be run without setting <code>num_components</code> to an integer value.</p><p>You can set the type as <code>int</code>, <code>float</code>, <code>double</code> or <code>bool</code>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="data-flow-through-the-graph">Data flow through the graph<a class="hash-link" href="#data-flow-through-the-graph" title="Direct link to heading">​</a></h2><p>As previously mentioned, for <a href="/v/r/metaflow/basics#linear">linear</a> steps, data artifacts are
propagated and any linear step can access data artifacts created by previous steps using
instance variables. In this case, Metaflow can easily determine the value of each
artifact by simply taking the value of that artifact at the end of the previous step.</p><p>In a join step, however, the value of artifacts can potentially be set to different
values on the incoming branches; the value of the artifact is said to be ambiguous.</p><p>To make it easier to implement a join step after foreach or branch, Metaflow provides a
utility function, <code>merge_artifacts</code>, to aid in propagating unambiguous values.</p><div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">library(metaflow)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start &lt;- function(self){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self$pass_down &lt;- &quot;non-modified&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a &lt;- function(self){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self$common &lt;- &quot;common in a and b&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self$x &lt;- &quot;x in a&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self$y &lt;- &quot;y in a&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self$from_a &lt;- &quot;only in a&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b &lt;- function(self){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self$common &lt;- &quot;common in a and b&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self$x &lt;- &quot;x in b&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self$y &lt;- &quot;y in b&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">join &lt;- function(self, inputs){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # manually propogate variable that has different values in different branches</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self$x &lt;- inputs$a$x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    merge_artifacts(self, inputs, exclude=list(&quot;y&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Without merge_artifact, the following artifact accesses wouldn’t work.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(paste(&#x27;pass_down is&#x27;, self$pass_down))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(paste(&#x27;from_a is&#x27;, self$from_a))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(paste(&#x27;common is&#x27;, self$common))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metaflow(&quot;BranchFlow&quot;) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    step(step = &quot;start&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         r_function=start,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         next_step = c(&quot;a&quot;, &quot;b&quot;)) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    step(step = &quot;a&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         r_function=a,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         next_step=&quot;join&quot;) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    step(step=&quot;b&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         r_function=b,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         next_step=&quot;join&quot;) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    step(step=&quot;join&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         r_function=join,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         next_step=&quot;end&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         join=TRUE) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    step(step=&quot;end&quot;) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    run()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the example above, the <code>merge_artifacts</code> function behaves as follows:</p><ul><li><code>pass_down</code> is propagated because it is unmodified in both <code>a</code> and <code>b</code>.</li><li><code>common</code> is also propagated because it is set to the same value in both branches.
Remember that it is the value of the artifact that matters when determining whether an
artifact is ambiguous; Metaflow uses content based deduplication to store artifacts
and can therefore determine if the value of two artifacts is the same.</li><li><code>x</code> is handled by the code explicitly <em>prior</em> to the call to <code>merge_artifacts</code> which
causes <code>merge_artifacts</code> to ignore <code>x</code> when propagating artifacts. This pattern allows
you to manually resolve any ambiguity in artifacts you would like to see propagated.</li><li><code>y</code> is not propagated because it is listed in the <code>exclude</code> list. This pattern allows
you to prevent the propagation of artifacts that are no longer relevant. Remember that
the default behavior of <code>merge_artifacts</code> is to propagate all incoming artifacts.</li><li><code>from_a</code> is propagated because it is only set in one branch and therefore is
unambiguous. <code>merge_artifacts</code>will propagate all values even if they are present on
only one incoming branch.</li></ul><p>The <code>merge_artifacts</code> function will raise an exception if an artifact that it should
merge has an ambiguous value. Remember that <code>merge_artifacts</code> will attempt to merge all
incoming artifacts except if they are already present in the step or have been
explicitly excluded in the <code>exclude</code> list.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.dev/Netflix/metaflow-docs/blob/master/docs/v/r/metaflow/basics.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-structure-of-metaflow-code" class="table-of-contents__link toc-highlight">The Structure of Metaflow Code</a><ul><li><a href="#linear" class="table-of-contents__link toc-highlight">Linear</a></li><li><a href="#branch" class="table-of-contents__link toc-highlight">Branch</a></li><li><a href="#foreach" class="table-of-contents__link toc-highlight">Foreach</a></li></ul></li><li><a href="#what-should-be-a-step" class="table-of-contents__link toc-highlight">What should be a step?</a></li><li><a href="#how-to-define-parameters-for-flows" class="table-of-contents__link toc-highlight">How to define parameters for flows?</a></li><li><a href="#data-flow-through-the-graph" class="table-of-contents__link toc-highlight">Data flow through the graph</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.e3449fb1.js"></script>
<script src="/assets/js/main.591a0229.js"></script>
</body>
</html>