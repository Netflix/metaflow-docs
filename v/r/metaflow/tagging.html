<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EYFXNGNGB6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-EYFXNGNGB6",{anonymize_ip:!0})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Metaflow Docs" href="/opensearch.xml"><title data-react-helmet="true">Organizing Results | Metaflow Docs</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:image" content="https://docs.metaflow.org/img/Metaflow_Logo_Vertical_FullColor_Ribbon_Dark_RGB.png"><meta data-react-helmet="true" name="twitter:image" content="https://docs.metaflow.org/img/Metaflow_Logo_Vertical_FullColor_Ribbon_Dark_RGB.png"><meta data-react-helmet="true" property="og:url" content="https://docs.metaflow.org/v/r/metaflow/tagging"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Organizing Results | Metaflow Docs"><meta data-react-helmet="true" name="description" content="A boring, under-appreciated part of high-quality science \(or any project work in general\), is keeping results organized. This is the key to effective collaboration, versioning of parallel lines of work, and reproducibility."><meta data-react-helmet="true" property="og:description" content="A boring, under-appreciated part of high-quality science \(or any project work in general\), is keeping results organized. This is the key to effective collaboration, versioning of parallel lines of work, and reproducibility."><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.metaflow.org/v/r/metaflow/tagging"><link data-react-helmet="true" rel="alternate" href="https://docs.metaflow.org/v/r/metaflow/tagging" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.metaflow.org/v/r/metaflow/tagging" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://5IZ8L9TJQL-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.bf7ddef0.css">
<link rel="preload" href="/assets/js/runtime~main.6ee1b9e2.js" as="script">
<link rel="preload" href="/assets/js/main.8bbc3b8a.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/Metaflow_Logo_Horizontal_OneColor_White_RGB.svg" alt="Metaflow Logo" class="themedImage_W2Cr themedImage--light_TfLj" height="64px"><img src="/img/Metaflow_Logo_Horizontal_OneColor_White_RGB.svg" alt="Metaflow Logo" class="themedImage_W2Cr themedImage--dark_oUvU" height="64px"></div></a><a class="navbar__item navbar__link" href="/">Python Docs</a><a class="navbar__item navbar__link navbar__link--active" href="/v/r">R Docs</a><a href="https://outerbounds.com/docs/admin" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Admin Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><div class="toggle_Pssr toggle_TdHA toggleDisabled_jDku"><div class="toggleTrack_SSoT" role="button" tabindex="-1"><div class="toggleTrackCheck_XobZ"><span class="toggleIcon_eZtF">ðŸŒœ</span></div><div class="toggleTrackX_YkSC"><span class="toggleIcon_eZtF">ðŸŒž</span></div><div class="toggleTrackThumb_uRm4"></div></div><input type="checkbox" class="toggleScreenReader_JnkT" aria-label="Switch between dark and light mode"></div><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/v/r">Welcome to Metaflow for R</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/v/r/introduction/why-metaflow">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/v/r/getting-started/install">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/v/r/metaflow-on-aws">Metaflow on AWS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_VCh3" aria-current="page" href="/v/r/metaflow/basics">Developing with Metaflow</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v/r/metaflow/basics">Basics of Metaflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v/r/metaflow/client">Inspecting Flows and Results</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v/r/metaflow/debugging">Debugging with Metaflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v/r/metaflow/scaling">Scaling Out and Up</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/v/r/metaflow/failures">Dealing with Failures</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/v/r/metaflow/tagging">Organizing Results</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_VCh3" href="/v/r/going-to-production-with-metaflow/scheduling-metaflow-flows">Going to Production with Metaflow</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Organizing Results</h1><p>A boring, under-appreciated part of high-quality science <!-- -->(<!-- -->or any project work in general<!-- -->)<!-- -->, is keeping results organized. This is the key to effective collaboration, versioning of parallel lines of work, and reproducibility.</p><p>The good news is that Metaflow does 80% of this work for you without you having to do anything. This document explains how Metaflow keeps things organized with a concept called <strong>namespaces</strong> and how you can optionally make results even neater with <strong>tags</strong>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="namespaces">Namespaces<a class="hash-link" href="#namespaces" title="Direct link to heading">â€‹</a></h2><p>As explained in <a href="/v/r/metaflow/basics">Basics of Metaflow</a>, Metaflow persists all runs and all the data artifacts they produce. Every run gets a unique run ID, e.g. <code>HelloFlow/546</code>, which can be used to refer to a specific set of results. You can access these results with the <a href="/v/r/metaflow/client">Client API</a>.</p><p>Many users can use Metaflow concurrently. Imagine that Anne and Will are collaborating on a project that consists of two flows, <code>PredictionFlow</code> and <code>FeatureFlow</code>. As they, amongst other people, run their versions independently they end up with the following runs:</p><p><img src="/assets/images/assets_metaflow_-lpjn0yp7r49jrnxca_5_-lpjryuuy7v5kovmxtsv_namespace1-0868414851a2703b7058dda77294743a.png" width="596" height="418"></p><p>Anne could analyze her latest <code>PredictionFlow</code> results in a notebook by remembering that her latest run is <code>PredictionFlow/8</code>. Fortunately, Metaflow makes this even easier thanks to <strong>namespaces</strong>:</p><p><img src="/assets/images/assets_metaflow_-lpjn0yp7r49jrnxca_5_-lpjryuvqmspdu9w5imb_namespace2-e6724671478c141360319922e3eb45b5.png" width="686" height="494"></p><p>When Anne runs <code>PredictionFlow</code>, her runs are automatically <strong>tagged</strong> with her user name, prefixed with <code>user:</code>. By default, when Anne uses the <a href="/v/r/metaflow/client">Client API</a>, the API only returns results that are tagged with <code>user:anne</code>. Instead of having to remember the exact ID of her latest run, she can simply say:</p><div class="codeBlockContainer_I0IT language-r theme-code-block"><div class="codeBlockContent_wNvx r"><pre tabindex="0" class="prism-code language-r codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">library(metaflow)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run &lt;- flow_client$new(&#x27;PredictionFlow&#x27;)$latest_run</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>For Anne, this will return <code>&#x27;PredictionFlow/8&#x27;</code>. For Will, this will return <code>&#x27;PredictionFlow/5&#x27;</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="switching-namespaces">Switching Namespaces<a class="hash-link" href="#switching-namespaces" title="Direct link to heading">â€‹</a></h3><p>Namespaces are not about security or access control. They help you to keep results organized. During development, organizing results by the user who produced them is a sensible default.</p><p>You can freely explore results produced by other people. In a notebook <!-- -->(<!-- -->for example<!-- -->)<!-- -->, Anne can write</p><div class="codeBlockContainer_I0IT language-r theme-code-block"><div class="codeBlockContent_wNvx r"><pre tabindex="0" class="prism-code language-r codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">library(metaflow)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set_namespace(&#x27;user:will&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run &lt;- flow_client$new(&#x27;PredictionFlow&#x27;)$latest_run</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>to see Will&#x27;s latest results, in this case, <code>&#x27;PredictionFlow/5&#x27;</code>.</p><p>You can also access a specific run given its ID directly:</p><div class="codeBlockContainer_I0IT language-r theme-code-block"><div class="codeBlockContent_wNvx r"><pre tabindex="0" class="prism-code language-r codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">library(metaflow)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run &lt;- flow_client$new(&#x27;PredictionFlow&#x27;)$run(&quot;5&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>However, this will fail for Anne, since <code>PredictionFlow/5</code> is in Will&#x27;s namespace. An important feature of namespaces is to make sure that you can&#x27;t accidentally use someone else&#x27;s results, which could lead to hard to debug, incorrect analyses.</p><p>If Anne wants to access Will&#x27;s results, she must do so explicitly by switching to Will&#x27;s namespace:</p><div class="codeBlockContainer_I0IT language-r theme-code-block"><div class="codeBlockContent_wNvx r"><pre tabindex="0" class="prism-code language-r codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">library(metaflow)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set_namespace(&#x27;user:will&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run &lt;- flow_client$new(&#x27;PredictionFlow&#x27;)$run(&quot;5&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>In other words, you can use the Client API freely without having to worry about using incorrect results by accident.</p><p>If you use the Client API in your flows to access results of other flows, you can use the <code>--namespace</code> flag on the command line to switch between namespaces. This is a better approach than hardcoding a <code>set_namespace()</code> function call in the code that defines your Metaflow workflow.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="global-namespace">Global Namespace<a class="hash-link" href="#global-namespace" title="Direct link to heading">â€‹</a></h3><p>What if you know a run ID but you don&#x27;t know whose namespace it belongs to? No worries, you can access all results in the Metaflow universe in the <strong>global namespace</strong>:</p><div class="codeBlockContainer_I0IT language-r theme-code-block"><div class="codeBlockContent_wNvx r"><pre tabindex="0" class="prism-code language-r codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">library(metaflow)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set_namespace(NULL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run &lt;- flow_client$new(&#x27;PredictionFlow&#x27;)$run(&quot;5&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Running <code>set_namespace(NULL)</code> allows you to access all results without limitations. Be careful though: relative references like <code>latest_run</code> make little sense in the global namespace since anyone can produce a new run at any time.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="resuming-across-namespaces">Resuming across namespaces<a class="hash-link" href="#resuming-across-namespaces" title="Direct link to heading">â€‹</a></h3><p><a href="/v/r/metaflow/debugging#how-to-use-the-resume-command">The <code>resume</code> command</a> is smart enough to work across production and personal namespaces. You can <code>resume</code> a production workflow without having to do anything special with namespaces.</p><p>You can resume runs of other users and you can resume any production runs. The results of your resumed runs are always created in your personal namespace.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="production-namespaces">Production Namespaces<a class="hash-link" href="#production-namespaces" title="Direct link to heading">â€‹</a></h2><p>During development, namespacing by the user name feels natural. However, when you <a href="/v/r/going-to-production-with-metaflow/scheduling-metaflow-flows">schedule your flow to run automatically</a>, runs are not related to a specific user anymore. It is typical for multiple people to collaborate on a project that has a canonical production version. It is not obvious which user &quot;owns&quot; the production version.</p><p>Moreover, it is critical that you, and all other people, can keep experimenting on the project without having to worry about breaking the production version. If the production flow ran in the namespace of any individual, relative references like <code>latest_run</code> could break the production easily as the user keeps executing experimental runs.</p><p>As a solution, by default the production namespace is made separate from the user namespace:</p><p><img src="/assets/images/namespace4_(3)-9e825aaf633bd9c3557c35b34291c647.png" width="881" height="498"></p><p>Isolated production namespaces have three main benefits:</p><ol><li>Production tokens allow all users of Metaflow to <strong>experiment freely</strong> with any project without having to worry about accidentally breaking a production deployment. Even if they ran step-functions create, they could not overwrite a production version without explicit consent, via a shared production token, by the person who did the previously authorized deployment.</li><li>An isolated production namespace makes it easy to <strong>keep production results separate from any experimental runs</strong> of the same project running concurrently. You can rest assured that when you switch to a production namespace, you will see only results related to production - nothing more, nothing less.</li><li>By having control over the production namespace, you can <strong>alter data that is seen by production flows</strong>. For instance, if you have separate training and prediction flows in production, the prediction flow can access the previously built model as long as one exists in the same namespace. By changing the production namespace, you can make sure that a new deployment isn&#x27;t tainted by old results.</li></ol><p>If you are a single developer working on a new project, you don&#x27;t have to do anything special to deal with production namespaces. You can rely on the default behavior of <code>step-functions create</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="production-tokens">Production tokens<a class="hash-link" href="#production-tokens" title="Direct link to heading">â€‹</a></h3><p>When you deploy a Flow to production for the first time, Metaflow creates a new, isolated production namespace for your production flow. This namespace is identified by a <strong>production token</strong>, which is a random identifier that identifies a production deployment, e.g. production:PredictionFlow3 above. You can examine production results in a notebook by switching to the production namespace.</p><p>If another person wants to deploy a new version of the flow to production, they must use the same production token. You, or whoever has the token, are responsible for sharing it with users who are authorized to deploy new versions to production. This manual step should prevent random users from deploying versions to production inadvertently.</p><p>After you have shared the production token with another person, they can deploy a new version with</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LplD tabs__item--active">Bash</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LplD">RStudio</li></ul><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Rscript production_flow.R step-functions create --authorize TOKEN_YOU_SHARED_WITH_THEM</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_I0IT language-r theme-code-block"><div class="codeBlockContent_wNvx r"><pre tabindex="0" class="prism-code language-r codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  step(step = &quot;end&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ...)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  run(step_fucntions = &quot;create&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    authorize = &quot;TOKEN_YOU_SHARED_WITH_THEM&quot;)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div></div></div><p>They need to use the <code>--authorize</code> option only once. Metaflow stores the token for them after the first deployment, so they need to do this only once.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="resetting-a-production-namespace">Resetting a production namespace<a class="hash-link" href="#resetting-a-production-namespace" title="Direct link to heading">â€‹</a></h3><p>If you call <code>step-functions create</code> again, it will deploy an updated version of your code in the existing production namespace of the flow.</p><p>Sometimes the code has changed so drastically that you want to recreate a fresh namespace for its results. You can do this as follows:</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LplD tabs__item--active">Bash</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LplD">RStudio</li></ul><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Rscript production_flow.R step-functions create --generate-new-token</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_I0IT language-r theme-code-block"><div class="codeBlockContent_wNvx r"><pre tabindex="0" class="prism-code language-r codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  step(step = &quot;end&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ...)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  run(step_fucntions = &quot;create&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      generate_new_token = TRUE)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div></div></div><p>This will deploy a new version in production using a fresh, empty namespace</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="tagging">Tagging<a class="hash-link" href="#tagging" title="Direct link to heading">â€‹</a></h2><p>The <code>user:</code> tag is assigned by Metaflow automatically. In addition to automatically assigned tags, you can add and remove arbitrary tags in objects. Tags are an excellent way to add extra annotations to runs, tasks etc., which makes it easier for you and other people to find and retrieve results of interest.</p><p>An easy way to add tags is the <code>--tag</code> command line option. You can add multiple tags with multiple <code>--tag</code> options. For instance, this will annotate a <code>HelloFlow</code> run with a tag <code>crazy_test</code>.</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LplD tabs__item--active">Terminal</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LplD">RStudio</li></ul><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Rscript helloworld.R run --tag crazy_test</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># Replace run() in helloworld.R with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># run(tag = c(&quot;crazy_test&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># and execute in RStudio</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div></div></div><p>The <code>--tag</code> option assigns the specified tag to all objects produced by the run: the run itself, its steps, tasks, and data artifacts.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="accessing-tags">Accessing Tags<a class="hash-link" href="#accessing-tags" title="Direct link to heading">â€‹</a></h3><p>You can access runs <!-- -->(<!-- -->or steps or tasks<!-- -->)<!-- --> with a certain tag easily using the Client API:</p><div class="codeBlockContainer_I0IT language-r theme-code-block"><div class="codeBlockContent_wNvx r"><pre tabindex="0" class="prism-code language-r codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">library(metaflow)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run &lt;- flow_client$new(&quot;HelloFlow&quot;).runs_with_tags(&quot;crazy_test&quot;)[[1]]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This will return the latest run of <code>HelloFlow</code> with a tag <code>crazy_test</code> in your namespace. Filtering is performed both based on the current <code>set_namespace()</code> and the tag filter.</p><p>You can also filter by multiple tags:</p><div class="codeBlockContainer_I0IT language-r theme-code-block"><div class="codeBlockContent_wNvx r"><pre tabindex="0" class="prism-code language-r codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">library(metaflow)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run &lt;- flow_client$new(&quot;HelloFlow&quot;).runs_with_tags(&quot;crazy_test&quot;, &quot;date:2020-06-01&quot;)[[1]]</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This requires that all the tags listed, and the current namespace, are present in the object.</p><p>You can see the set of tags assigned to an object with the <code>.tags</code> property. In the above case, <code>run.tags</code> would return a set with a string <code>crazy_test</code> amongst other automatically assigned tags.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="tags-as-namespaces">Tags as Namespaces<a class="hash-link" href="#tags-as-namespaces" title="Direct link to heading">â€‹</a></h3><p>Let&#x27;s consider again the earlier example with Anne and Will. They are working on their own versions of <code>PredictionFlow</code> but they want to collaborate on <code>FeatureFlow</code>. They could add a descriptive tag, say <code>xyz_features</code>, to <code>FeatureFlow</code> runs.</p><p>Now, they can easily get the latest results of <code>FeatureFlow</code> regardless of the user who ran the flow:</p><div class="codeBlockContainer_I0IT language-r theme-code-block"><div class="codeBlockContent_wNvx r"><pre tabindex="0" class="prism-code language-r codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">library(metaflow)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set_namespace(&#x27;xyz_features&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run &lt;- flow_client$new(&#x27;FeatureFlow&#x27;)$latest_run</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This will return <code>FeatureFlow/34</code> which happened to be run by Anne. If Will runs the flow again, his results will be the latest results in this namespace.</p><p>We encourage you to use a combination of namespaces, domain-specific tags, and filtering by tags to design a workflow that works well for your project.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="accessing-current-ids-in-a-flow">Accessing Current IDs in a Flow<a class="hash-link" href="#accessing-current-ids-in-a-flow" title="Direct link to heading">â€‹</a></h2><p>Tagging and namespaces, together with the <a href="/v/r/metaflow/client">Client API</a>, are the main ways for accessing results of past runs. Metaflow uses these mechanisms to organize and isolate results automatically, so in most cases you don&#x27;t have to do anything.</p><p>However, in some cases you may need to deal with IDs explicitly. For instance, if your flow interacts with external systems, it is a good idea to inform the external system about the identity of the run, so you can trace back any issues to a specific run. Also IDs can come in handy if you need to version externally stored data.</p><p>For this purpose, Metaflow provides a singleton object <code>current</code> that represents the identity of the currently running task. Use it in your <code>FlowSpec</code> to retrieve current IDs of interest:</p><div class="codeBlockContainer_I0IT language-r theme-code-block"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_BvAR">current_flow.R</div><div class="codeBlockContent_wNvx r"><pre tabindex="0" class="prism-code language-r codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">library(metaflow)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start &lt;- function(self){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(paste0(&quot;flow name: &quot;, current(&quot;flow_name&quot;)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(paste0(&quot;run id: &quot;, current(&quot;run_id&quot;)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(paste0(&quot;origin run id: &quot;, current(&quot;origin_run_id&quot;)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(paste0(&quot;step name: &quot;, current(&quot;step_name&quot;)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(paste0(&quot;task id: &quot;, current(&quot;task_id&quot;)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(paste0(&quot;pathspec: &quot;, current(&quot;pathspec&quot;)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print(paste0(&quot;username: &quot;, current(&quot;username&quot;)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metaflow(&quot;CurrentFlow&quot;) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    step(step=&quot;start&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         r_function=start,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         next_step=&quot;end&quot;) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    step(step=&quot;end&quot;) %&gt;%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    run()</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You can see the output</p><div class="codeBlockContainer_I0IT language-r theme-code-block"><div class="codeBlockContent_wNvx r"><pre tabindex="0" class="prism-code language-r codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">2020-06-19 21:19:03.387 [198/start/1139 (pid 64853)] [1] &quot;flow name: CurrentFlow&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-06-19 21:19:03.387 [198/start/1139 (pid 64853)] [1] &quot;run id: 198&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-06-19 21:19:03.387 [198/start/1139 (pid 64853)] [1] &quot;origin run id: &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-06-19 21:19:03.388 [198/start/1139 (pid 64853)] [1] &quot;step name: start&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-06-19 21:19:03.388 [198/start/1139 (pid 64853)] [1] &quot;task id: 1139&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-06-19 21:19:03.389 [198/start/1139 (pid 64853)] [1] &quot;pathspec: CurrentFlow/198/start/1139&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-06-19 21:19:03.389 [198/start/1139 (pid 64853)] [1] &quot;username: jge&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2020-06-19 21:19:08.400 [198/start/1139 (pid 64853)] Task finished successfully.</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The <code>current</code> singleton also provides programmatic access to the CLI option <code>--origin-run-id</code> used by the <a href="/v/r/metaflow/debugging#how-to-use-the-resume-command">resume</a> within your flow code.</p><p>For regular <code>run</code> invocations, the value of <code>current(&quot;origin_run_id&quot;)</code> is <code>NULL</code>.</p><p>If a user explicitly overrides the CLI option <code>--origin-run-id</code>, the <code>current</code> singleton would reflect that value. Suppose we invoked <code>resume</code> for the above script to re-run everything from <code>start</code> without explicitly overriding the CLI option <code>origin-run-id</code>, we can see the value chosen by Metaflow using the <code>current</code> singleton:</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LplD tabs__item--active">Bash</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LplD">RStudio</li></ul><div class="margin-vert--md"><div role="tabpanel"><div class="codeBlockContainer_I0IT language-r theme-code-block"><div class="codeBlockContent_wNvx r"><pre tabindex="0" class="prism-code language-r codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">Rscript current_flow.R resume start</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain"># Replace run() in current_flow.R with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># run(resume = &quot;start&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># and execute in RStudio</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div></div></div><p>You should see the <code>origin_run_id</code> used by the <code>resume</code> in the output <!-- -->(<!-- -->the exact value for you might be different<!-- -->)<!-- -->:</p><div class="codeBlockContainer_I0IT language-r theme-code-block"><div class="codeBlockContent_wNvx r"><pre tabindex="0" class="prism-code language-r codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;origin run id: 198&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.dev/Netflix/metaflow-docs/blob/master/docs/v/r/metaflow/tagging.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/v/r/metaflow/failures"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Dealing with Failures</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/v/r/going-to-production-with-metaflow/scheduling-metaflow-flows"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Scheduling Metaflow Flows</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#namespaces" class="table-of-contents__link toc-highlight">Namespaces</a><ul><li><a href="#switching-namespaces" class="table-of-contents__link toc-highlight">Switching Namespaces</a></li><li><a href="#global-namespace" class="table-of-contents__link toc-highlight">Global Namespace</a></li><li><a href="#resuming-across-namespaces" class="table-of-contents__link toc-highlight">Resuming across namespaces</a></li></ul></li><li><a href="#production-namespaces" class="table-of-contents__link toc-highlight">Production Namespaces</a><ul><li><a href="#production-tokens" class="table-of-contents__link toc-highlight">Production tokens</a></li><li><a href="#resetting-a-production-namespace" class="table-of-contents__link toc-highlight">Resetting a production namespace</a></li></ul></li><li><a href="#tagging" class="table-of-contents__link toc-highlight">Tagging</a><ul><li><a href="#accessing-tags" class="table-of-contents__link toc-highlight">Accessing Tags</a></li><li><a href="#tags-as-namespaces" class="table-of-contents__link toc-highlight">Tags as Namespaces</a></li></ul></li><li><a href="#accessing-current-ids-in-a-flow" class="table-of-contents__link toc-highlight">Accessing Current IDs in a Flow</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.6ee1b9e2.js"></script>
<script src="/assets/js/main.8bbc3b8a.js"></script>
</body>
</html>