<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-internals/technical-overview">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EYFXNGNGB6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-EYFXNGNGB6",{anonymize_ip:!0})</script><title data-rh="true">Technical Overview | Metaflow Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.metaflow.org/img/og-metaflow.png"><meta data-rh="true" name="twitter:image" content="https://docs.metaflow.org/img/og-metaflow.png"><meta data-rh="true" property="og:url" content="https://docs.metaflow.org/internals/technical-overview"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="og:width" content="200"><meta data-rh="true" name="og:height" content="126"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Technical Overview | Metaflow Docs"><meta data-rh="true" name="description" content="Make sure you have read Basics of Metaflow before diving into"><meta data-rh="true" property="og:description" content="Make sure you have read Basics of Metaflow before diving into"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.metaflow.org/internals/technical-overview"><link data-rh="true" rel="alternate" href="https://docs.metaflow.org/internals/technical-overview" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.metaflow.org/internals/technical-overview" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://5IZ8L9TJQL-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.57e5c9db.css">
<link rel="preload" href="/assets/js/runtime~main.46b91267.js" as="script">
<link rel="preload" href="/assets/js/main.f9ec58aa.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_jvwV"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/Metaflow_Logo_Horizontal_OneColor_DarkBlue_RGB.svg" alt="Metaflow Logo" class="themedImage_ToTc themedImage--light_HNdA" height="30"><img src="/img/Metaflow_Logo_Horizontal_OneColor_White_RGB.svg" alt="Metaflow Logo" class="themedImage_ToTc themedImage--dark_i4oU" height="30"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Documentation</a><a href="https://outerbounds.com/docs/admin" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Deployment Guide<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div style="display:flex;align-items:center"><div class="responsivePadding_cpaU" style="display:flex;align-items:center;gap:0.75rem"><a href="https://github.com/Netflix/metaflow" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><img src="/img/github.svg" alt="GitHub" class="logo_v_H3 githubLogo"></a><a href="http://slack.outerbounds.co/" target="_blank" rel="noopener noreferrer" aria-label="Slack"><img class="logo_v_H3" src="/img/slack.svg" alt="Slack"></a></div><div class="toggle_vylO colorModeToggle_x44X"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/Metaflow_Logo_Horizontal_OneColor_DarkBlue_RGB.svg" alt="Metaflow Logo" class="themedImage_ToTc themedImage--light_HNdA" height="30"><img src="/img/Metaflow_Logo_Horizontal_OneColor_White_RGB.svg" alt="Metaflow Logo" class="themedImage_ToTc themedImage--dark_i4oU" height="30"></a><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Welcome to Metaflow</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/introduction/why-metaflow">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/getting-started/install">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/metaflow/introduction">Developing Flows</a><button aria-label="Toggle the collapsible sidebar category &#x27;Developing Flows&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/scaling/introduction">Scaling Flows</a><button aria-label="Toggle the collapsible sidebar category &#x27;Scaling Flows&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/production/introduction">Deploying to Production</a><button aria-label="Toggle the collapsible sidebar category &#x27;Deploying to Production&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/api">API Reference</a><button aria-label="Toggle the collapsible sidebar category &#x27;API Reference&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/internals/release-notes">Internals of Metaflow</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/internals/release-notes">Release Notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/internals/technical-overview">Technical Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/internals/testing-philosophy">Testing Philosophy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/internals/contributing">Contributing to Metaflow</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Internals of Metaflow</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Technical Overview</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Technical Overview</h1><p>Make sure you have read <a href="/metaflow/basics">Basics of Metaflow</a> before diving into
technical details below. You can find more technical details at the infrastructure level
in <a href="https://outerbounds.com/docs/admin" target="_blank" rel="noopener noreferrer">Administrator&#x27;s Guide to Metaflow</a>. This
document focuses on the Metaflow codebase.</p><p>We wanted to build a data science platform that can make data science code usable,
scalable, reproducible, and production-ready, as described in the <a href="/introduction/why-metaflow">Why
Metaflow</a> section. There are many ways to achieve these
high-level goals. We took an approach designed around the following four core functions:</p><ol><li>Provide a highly usable API for structuring the code as a workflow, i.e. as a
directed graph of steps (<strong>usability</strong>).</li><li>Persist an immutable snapshot of data, code, and external dependencies required to
execute each step (<strong>reproducibility</strong>).</li><li>Facilitate execution of the steps in various environments, from development to
production (<strong>scalability</strong>, <strong>production-readiness</strong>).</li><li>Record metadata about previous executions and make them easily accessible
(<strong>usability</strong>, <strong>reproducibility</strong>).</li></ol><p>This document gives an overview of how the core functionality is implemented.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="architecture">Architecture<a class="hash-link" href="#architecture" title="Direct link to heading">​</a></h2><p>Here is a high-level architecture diagram of Metaflow:</p><p><img loading="lazy" src="/assets/images/Untitled_presentation-34865e5b1cf54ada93d00a186bc75832.png" width="710" height="828" class="img_ev3q"></p><p>Below, we will describe the components in detail. To highlight the time-dimension which
is missing from the diagram, we group the descriptions by the following phases in the
development lifecycle:</p><ol><li>Development-time, i.e. when the code gets written.</li><li>Runtime, i.e. when the code gets run.</li><li>Result-time, i.e. when the results of the run get used.</li></ol><p>Every component includes links to source files where the functionality is implemented.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="development-time-components">Development-Time Components<a class="hash-link" href="#development-time-components" title="Direct link to heading">​</a></h2><p>The core development-time concept in Metaflow is a <em>flow</em>. It represents the business
logic of what needs to be computed.</p><p>How to intertwine the business logic with the framework in the most <strong>usable</strong> manner is
a central design concern of Metaflow. We want to encourage the user to structure the
code in a way that enables <strong>reproducibility</strong> and <strong>scalability</strong>.</p><p>In contrast, we would like to minimize concerns related to production-readiness during
development time. Optimally, the user can write idiomatic Python code focusing on the
logic itself and the guard rails of the framework will automatically make the code
production-ready.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="flow"><strong>Flow</strong><a class="hash-link" href="#flow" title="Direct link to heading">​</a></h3><p>A flow is the smallest unit of computation that can be scheduled for execution.
Typically, a flow defines a workflow that pulls data from an external source as input,
processes it in several steps, and produces output data.</p><p>User implements a flow by subclassing <code>FlowSpec</code> and implementing steps as methods.
Besides steps, a flow can define other attributes relevant for scheduling, such as
parameters and data triggers.</p><ul><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/flowspec.py" target="_blank" rel="noopener noreferrer"><code>flowspec.py</code> - base class for
flows</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="graph">Graph<a class="hash-link" href="#graph" title="Direct link to heading">​</a></h3><p>Metaflow infers a directed (typically acyclic) graph based on the transitions between
step functions.</p><p>Metaflow requires the transitions to be defined so that the graph can be parsed from the
source code of the flow statically. This makes it possible to translate the graph for
execution by runtimes that support only statically defined graphs, such as Meson.</p><ul><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/graph.py" target="_blank" rel="noopener noreferrer"><code>graph.py</code> - internal representation of the
graph</a></li><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/lint.py" target="_blank" rel="noopener noreferrer"><code>lint.py</code> - verifies that the graph is
valid</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step">Step<a class="hash-link" href="#step" title="Direct link to heading">​</a></h3><p>A step is the smallest resumable unit of computation. It is implemented by the user as a
method that is decorated with the <code>@step</code> decorator in a flow class.</p><p>A step is <a href="https://en.wikipedia.org/wiki/Application_checkpointing" target="_blank" rel="noopener noreferrer">a checkpoint</a>.
Metaflow takes a snapshot of the data produced by a step which in turn is used as input
to the subsequent steps. Hence, if a step fails, it can be resumed without rerunning the
preceding steps.</p><p>Being able to resume execution is a powerful feature. It would be convenient to be able
to resume execution at any arbitrary line of code. The main reason why checkpointing is
done at the step level instead of line level is the overhead of saving state. The user
is encouraged to keep the steps small but not so small that the overhead becomes
noticeable.</p><ul><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/flowspec.py" target="_blank" rel="noopener noreferrer"><code>flowspec.py</code> - steps belong to a
flow</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="decorators">Decorators<a class="hash-link" href="#decorators" title="Direct link to heading">​</a></h3><p>The behavior of a step can be modified with decorators. Tags are the main mechanism for
extending Metaflow. For instance, a decorator can catch exceptions, implement a timeout,
or define resource requirements for a step.</p><p>A step may have arbitrary many decorators, implemented as Python decorators.</p><ul><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/decorators.py" target="_blank" rel="noopener noreferrer"><code>decorators.py</code> - base class for
decorators</a></li><li><a href="https://github.com/Netflix/metaflow/tree/master/metaflow/plugins" target="_blank" rel="noopener noreferrer"><code>plugins</code> - see various plugins for actual decorator
implementations</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-code">Step Code<a class="hash-link" href="#step-code" title="Direct link to heading">​</a></h3><p>Step code is the body of a step. It implements the actual business logic of flow.</p><p>It is possible to implement various language bindings, e.g. R, for Metaflow so that only
the language of the step code is changed while all the core functionality, implemented
in Python, stays intact.</p><p>All instance variables, e.g. <code>self.x</code>, used in the step code become <em>data artifacts</em>
that are persisted automatically. Stack variables, e.g. <code>x</code>, are not persisted. This
dichotomy allows the user to control the overhead of checkpointing by explicitly
choosing between persistent vs. non-persistent variables in the step code.</p><ul><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/tutorials/00-helloworld/helloworld.py" target="_blank" rel="noopener noreferrer"><code>helloworld.py</code> - example of a user-defined
flow</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="runtime-components">Runtime Components<a class="hash-link" href="#runtime-components" title="Direct link to heading">​</a></h2><p>The core runtime concept in Metaflow is a <em>run</em>, that is, an execution of a user-defined
flow. A run happens when the user executes <code>python myflow.py run</code> on the command line.</p><p>A key design decision of Metaflow is to make the framework runtime-agnostic. The same
code should be runnable in various environments, such as on a laptop during development
or on a <strong>production-ready</strong> workflow orchestrator during production.</p><p>Similarly, we want to provide seamless <strong>scalability</strong> by allowing the same code run on
a laptop in parallel over multiple processes or in the cloud over multiple batch jobs.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="task"><strong>Task</strong><a class="hash-link" href="#task" title="Direct link to heading">​</a></h3><p>The runtime counterpart of a step is a <em>task</em>. In runtime, a normal step spawns one task
for execution. A foreach split step may spawn multiple tasks which are identified by a
unique <em>foreach stack</em>.</p><ul><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/task.py" target="_blank" rel="noopener noreferrer"><code>task.py</code> - manages execution of a
task</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="code-package">Code Package<a class="hash-link" href="#code-package" title="Direct link to heading">​</a></h3><p>In order to be able to <strong>reproduce</strong> the results of a run, we need to snapshot the code
that was run.</p><p>Code package is an immutable snapshot of the relevant code in the working directory,
stored in the datastore, at the time when the run was started. A convenient side effect
of the snapshot is that it also works as a code distribution mechanism for runs that
happen in the cloud.</p><ul><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/package.py" target="_blank" rel="noopener noreferrer"><code>package.py</code> - code package
implementation</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="environment"><strong>Environment</strong><a class="hash-link" href="#environment" title="Direct link to heading">​</a></h3><p>Unfortunately, just snapshotting the working directory of the flow code is not
sufficient for reproducibility. The code often depends on external libraries which also
need to be included in the snapshot.</p><p>The concept of an <em>environment</em> is closely related to code packages. The environment
encapsulates both the flow code and its external dependencies, so that the exact
execution environment can be reproduced on a remote system accurately.</p><ul><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/metaflow_environment.py" target="_blank" rel="noopener noreferrer"><code>metaflow_environment.py</code> - environment base
class</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="runtime">Runtime<a class="hash-link" href="#runtime" title="Direct link to heading">​</a></h3><p>A run of a flow is executed by executing tasks defined by steps in a topological order.
It is the job of a runtime to orchestrate this execution. A better name for &quot;runtime&quot;
might be a scheduler.</p><p>For quick local iterations, Metaflow comes with a built-in runtime which executes tasks
as separate processes. However, this is not intended as a production-grade scheduler.</p><p>For production runs, one should use a runtime that supports retries, error reporting,
logging, is highly available, scalable, and preferably comes with a user-friendly UI. At
Netflix,
<a href="https://medium.com/netflix-techblog/meson-workflow-orchestration-for-netflix-recommendations-fc932625c1d9" target="_blank" rel="noopener noreferrer">Meson</a>
is such a runtime. It is well-supported by Metaflow.</p><p>A key feature of Metaflow is that it is agnostic of the runtime. The same code can be
executed both with the local runtime and with production runtime, which enables a rapid
development-deploy-debug cycle.</p><ul><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/runtime.py" target="_blank" rel="noopener noreferrer"><code>runtime.py</code> - local, process-based
runtime</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="datastore">Datastore<a class="hash-link" href="#datastore" title="Direct link to heading">​</a></h3><p>Metaflow requires an object store where both code snapshots and data artifacts can be
persisted. This data store should be accessible by all environments where Metaflow code
is executed. The AWS S3 is a perfect solution for this need. Secondarily, Metaflow
supports using a local disk as a data store, which is mainly useful during the
development of Metaflow itself.</p><p>An important feature of Metaflow is that the data store is used as a content-addressed
storage. Both code and data are identified by a hash of their contents, similar to Git,
so equal copies of data are deduplicated automatically. Note that this deduplication is
limited in scope however; data across different flows will not be deduplicated.</p><ul><li><a href="https://github.com/Netflix/metaflow/blob/master/scaling/datastore/datastore_storage.py" target="_blank" rel="noopener noreferrer"><code>datastore.py</code> - base class for data
stores</a></li><li><a href="https://github.com/Netflix/metaflow/blob/master/scaling/datastore/s3_storage.py" target="_blank" rel="noopener noreferrer"><code>s3.py</code> - default S3 data
store</a></li></ul><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="metadata-provider">Metadata Provider<a class="hash-link" href="#metadata-provider" title="Direct link to heading">​</a></h3><p>A centralized Metadata Provider keeps track of runs. Strictly speaking, this
functionality is not required by Metaflow, but it makes the system much more <strong>usable.</strong>
The service also helps to make data artifacts and other metadata about runs more
discoverable during result-time, as explained below.</p><ul><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/metadata/metadata.py" target="_blank" rel="noopener noreferrer"><code>metadata.py</code> - base class for metadata
providers</a></li><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/plugins/metadata/service.py" target="_blank" rel="noopener noreferrer"><code>service.py</code> - default implementation of the metadata
provider</a></li><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/plugins/metadata/local.py" target="_blank" rel="noopener noreferrer"><code>local.py</code> - local implementation of the metadata
provider</a></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="result-time-components">Result-time Components<a class="hash-link" href="#result-time-components" title="Direct link to heading">​</a></h2><p>Flows are defined and run for their results. Metaflow supports a number of different
ways to consume outputs of runs: Results can be written to Hive tables for consumption
by downstream systems and dashboards, they can be accessed in a notebook for further
analysis, or in a hosted web service (this last functionality is not yet available in
Open Source).</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="metaflow-client">Metaflow Client<a class="hash-link" href="#metaflow-client" title="Direct link to heading">​</a></h3><p>Metaflow provides a highly <strong>usable</strong> Python API to access results of previous runs,
called <code>metaflow.client</code>. A typical way to use <code>metaflow.client</code> is to access data
artifacts of past runs in a Jupyter notebook. It is extremely convenient to be able to
examine the internal state of production runs or perform further ad-hoc analysis of the
results in a notebook.</p><ul><li><a href="https://github.com/Netflix/metaflow/tree/master/metaflow/client" target="_blank" rel="noopener noreferrer"><code>metaflow.client</code> - client
subpackage</a></li><li><a href="https://github.com/Netflix/metaflow/blob/master/metaflow/client/core.py" target="_blank" rel="noopener noreferrer"><code>core.py</code> - core objects for the
client</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.dev/Netflix/metaflow-docs/blob/master/docs/internals/technical-overview.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/internals/release-notes"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Release Notes</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/internals/testing-philosophy"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Testing Philosophy</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#architecture" class="table-of-contents__link toc-highlight">Architecture</a></li><li><a href="#development-time-components" class="table-of-contents__link toc-highlight">Development-Time Components</a><ul><li><a href="#flow" class="table-of-contents__link toc-highlight"><strong>Flow</strong></a></li><li><a href="#graph" class="table-of-contents__link toc-highlight">Graph</a></li><li><a href="#step" class="table-of-contents__link toc-highlight">Step</a></li><li><a href="#decorators" class="table-of-contents__link toc-highlight">Decorators</a></li><li><a href="#step-code" class="table-of-contents__link toc-highlight">Step Code</a></li></ul></li><li><a href="#runtime-components" class="table-of-contents__link toc-highlight">Runtime Components</a><ul><li><a href="#task" class="table-of-contents__link toc-highlight"><strong>Task</strong></a></li><li><a href="#code-package" class="table-of-contents__link toc-highlight">Code Package</a></li><li><a href="#environment" class="table-of-contents__link toc-highlight"><strong>Environment</strong></a></li><li><a href="#runtime" class="table-of-contents__link toc-highlight">Runtime</a></li><li><a href="#datastore" class="table-of-contents__link toc-highlight">Datastore</a></li><li><a href="#metadata-provider" class="table-of-contents__link toc-highlight">Metadata Provider</a></li></ul></li><li><a href="#result-time-components" class="table-of-contents__link toc-highlight">Result-time Components</a><ul><li><a href="#metaflow-client" class="table-of-contents__link toc-highlight">Metaflow Client</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.46b91267.js"></script>
<script src="/assets/js/main.f9ec58aa.js"></script>
</body>
</html>