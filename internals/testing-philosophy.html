<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-internals/testing-philosophy">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EYFXNGNGB6"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-EYFXNGNGB6",{anonymize_ip:!0})</script><title data-rh="true">Testing Philosophy | Metaflow Docs</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.metaflow.org/img/og-metaflow.png"><meta data-rh="true" name="twitter:image" content="https://docs.metaflow.org/img/og-metaflow.png"><meta data-rh="true" property="og:url" content="https://docs.metaflow.org/internals/testing-philosophy"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="og:width" content="200"><meta data-rh="true" name="og:height" content="126"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Testing Philosophy | Metaflow Docs"><meta data-rh="true" name="description" content="Watch this talk for motivation: [Autonomous Testing and the Future of Software"><meta data-rh="true" property="og:description" content="Watch this talk for motivation: [Autonomous Testing and the Future of Software"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.metaflow.org/internals/testing-philosophy"><link data-rh="true" rel="alternate" href="https://docs.metaflow.org/internals/testing-philosophy" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.metaflow.org/internals/testing-philosophy" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://5IZ8L9TJQL-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.57e5c9db.css">
<link rel="preload" href="/assets/js/runtime~main.46b91267.js" as="script">
<link rel="preload" href="/assets/js/main.f9ec58aa.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_jvwV"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/Metaflow_Logo_Horizontal_OneColor_DarkBlue_RGB.svg" alt="Metaflow Logo" class="themedImage_ToTc themedImage--light_HNdA" height="30"><img src="/img/Metaflow_Logo_Horizontal_OneColor_White_RGB.svg" alt="Metaflow Logo" class="themedImage_ToTc themedImage--dark_i4oU" height="30"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Documentation</a><a href="https://outerbounds.com/docs/admin" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Deployment Guide<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div style="display:flex;align-items:center"><div class="responsivePadding_cpaU" style="display:flex;align-items:center;gap:0.75rem"><a href="https://github.com/Netflix/metaflow" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><img src="/img/github.svg" alt="GitHub" class="logo_v_H3 githubLogo"></a><a href="http://slack.outerbounds.co/" target="_blank" rel="noopener noreferrer" aria-label="Slack"><img class="logo_v_H3" src="/img/slack.svg" alt="Slack"></a></div><div class="toggle_vylO colorModeToggle_x44X"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/Metaflow_Logo_Horizontal_OneColor_DarkBlue_RGB.svg" alt="Metaflow Logo" class="themedImage_ToTc themedImage--light_HNdA" height="30"><img src="/img/Metaflow_Logo_Horizontal_OneColor_White_RGB.svg" alt="Metaflow Logo" class="themedImage_ToTc themedImage--dark_i4oU" height="30"></a><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Welcome to Metaflow</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/introduction/why-metaflow">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/getting-started/install">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/metaflow/introduction">Developing Flows</a><button aria-label="Toggle the collapsible sidebar category &#x27;Developing Flows&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/scaling/introduction">Scaling Flows</a><button aria-label="Toggle the collapsible sidebar category &#x27;Scaling Flows&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/production/introduction">Deploying to Production</a><button aria-label="Toggle the collapsible sidebar category &#x27;Deploying to Production&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/api">API Reference</a><button aria-label="Toggle the collapsible sidebar category &#x27;API Reference&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/internals/release-notes">Internals of Metaflow</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/internals/release-notes">Release Notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/internals/technical-overview">Technical Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/internals/testing-philosophy">Testing Philosophy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/internals/contributing">Contributing to Metaflow</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Internals of Metaflow</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Testing Philosophy</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Testing Philosophy</h1><p>Watch this talk for motivation: <a href="https://www.youtube.com/watch?v=fFSPwJFXVlw" target="_blank" rel="noopener noreferrer">Autonomous Testing and the Future of Software
Development by Will Wilson</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="metaflow-test-suite">Metaflow Test Suite<a class="hash-link" href="#metaflow-test-suite" title="Direct link to heading">​</a></h2><p>The integration test harness for the core Metaflow at <code>test/core</code>, generates and
executes synthetic Metaflow flows, exercising all aspects of Metaflow. The test suite is
executed using <a href="http://tox.readthedocs.io" target="_blank" rel="noopener noreferrer">tox</a> as configured in <code>tox.ini</code>. You can run
the tests by hand using <code>pytest</code> or <code>run_tests.py</code> as described below.</p><p>What happens when you execute <code>python helloworld.py run</code>? The execution involves
multiple layers of the Metaflow stack. The stack looks like following, starting from the
most fundamental layer all the way to the user interface:</p><ol><li>Python interpreter <!-- -->(<code>python2</code>, <code>python3</code>)</li><li>Metaflow core <!-- -->(<code>task.py</code>, <code>runtime.py</code>, <code>datastore</code>, etc.<!-- -->)</li><li>Metaflow plugins <!-- -->(<code>@timeout</code>, <code>@catch</code>, <code>metadata.py</code> etc.<!-- -->)</li><li>User-defined graph</li><li>User-defined step functions</li><li>User interface <!-- -->(<code>cli.py</code>, <code>metaflow.client</code>)</li></ol><p>We could write unit tests for functions in the layers 2, 3, and 6, which would capture
some bugs. However, a much larger superset of bugs is caused by unintended interactions
across the layers. For instance, exceptions caught by the <code>@catch</code> tag <!-- -->(<!-- -->3<!-- -->)<!-- --> inside a
deeply nested foreach graph <!-- -->(<!-- -->4<!-- -->)<!-- --> might not be returned correctly in the client API
<!-- -->(<!-- -->6<!-- -->)<!-- --> when using Python 3 <!-- -->(<!-- -->1<!-- -->)<!-- -->.</p><p>The integration test harness included in the <code>core</code> directory tries to surface bugs like
this by generating test cases automatically using <em>specifications</em> provided by the
developer.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="specifications">Specifications<a class="hash-link" href="#specifications" title="Direct link to heading">​</a></h2><p>The test harness allows you to customize behavior in four ways that correspond to the
layers above:</p><ol><li>You define the execution environment, including environment variables, the version of
the Python interpreter, and the type of datastore used as <em>contexts</em> in
<code>contexts.json</code> <!-- -->(<!-- -->layers 1 and 2<!-- -->)<!-- -->.</li><li>You define the step functions, the decorators used, and the expected results as
<code>MetaflowTest</code> templates, stored in the <code>tests</code> directory <!-- -->(<!-- -->layers 3 and 5<!-- -->)<!-- -->.</li><li>You define various graphs that match the step functions as simple JSON descriptions
of the graph structure, stored in the <code>graphs</code> directory <!-- -->(<!-- -->layer 4<!-- -->)<!-- -->.</li><li>You define various ways to check the results that correspond to the different user
interfaces of Metaflow as <code>MetaflowCheck</code> classes, stored in the <code>metaflow_test</code>
directory <!-- -->(<!-- -->layer 6<!-- -->)<!-- -->. You can customize which checkers get used in which contexts in
<code>context.json</code>.</li></ol><p>The test harness takes all <code>contexts</code>, <code>graphs</code>, <code>tests</code>, and <code>checkers</code> and generates a
test flow for every combination of them, unless you explicitly set constraints on what
combinations are allowed. The test flows are then executed, optionally in parallel, and
results are collected and summarized.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="contexts"><strong>Contexts</strong><a class="hash-link" href="#contexts" title="Direct link to heading">​</a></h3><p>Contexts are defined in <code>contexts.json</code>. The file should be pretty self-explanatory.
Most likely you do not need to edit the file unless you are adding tests for a new
command-line argument.</p><p>Note that some contexts have <code>disabled: true</code>. These contexts are not executed by
default when tests are run by a CI system. You can enable them on the command line for
local testing, as shown below.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tests"><strong>Tests</strong><a class="hash-link" href="#tests" title="Direct link to heading">​</a></h3><p>Take a look at <code>tests/basic_artifact.py</code>. This test verifies that artifacts defined in
the first step are available in all steps downstream. You can use this simple test as a
template for new tests.</p><p>Your test class should derive from <code>MetaflowTest</code>. The class variable <code>PRIORITY</code> denotes
how fundamental the exercised functionality is to Metaflow. The tests are executed in
the ascending order of priority, to make sure that foundations are solid before
proceeding to more sophisticated cases.</p><p>The step functions are decorated with the <code>@steps</code> decorator. Note that in contrast to
normal Metaflow flows, these functions can be applied to multiple steps in a graph. A
core idea behind this test harness is to decouple graphs from step functions, so various
combinations can be tested automatically. Hence, you need to provide step functions that
can be applied to various step types.</p><p>The <code>@steps</code> decorator takes two arguments. The first argument is an integer that
defines the order of precedence between multiple <code>steps</code> functions, in case multiple
step function templates match. A typical pattern is to provide a specific function for a
specific step type, such as joins and give it a precedence of <code>0</code>. Then another
catch-all can be defined with <code>@steps(2, [&#x27;all&#x27;])</code>. As the result, the special function
is applied to joins and the catch-all function for all other steps.</p><p>The second argument gives a list of <em>qualifiers</em> specifying which types of steps this
function can be applied to. There is a set of built-in qualifiers: <code>all</code>, <code>start</code>,
<code>end</code>, <code>join</code>, <code>linear</code> which match to the corresponding step types. In addition to
these built-in qualifiers, graphs can specify any custom qualifiers.</p><p>By specifying <code>required=True</code> as a keyword argument to <code>@steps</code>, you can require that a
certain step function needs to be used in combination with a graph to produce a valid
test case. By creating a custom qualifier and setting <code>required=True</code> you can control
how tests get matched to graphs.</p><p>In general, it is beneficial to write test cases that do not specify overly restrictive
qualifiers and <code>required=True</code>. This way you cast a wide net to catch bugs with many
generated test cases. However, if the test is slow to execute and/or does not benefit
from a large number of matching graphs, it is a good idea to make it more specific.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="assertions"><strong>Assertions</strong><a class="hash-link" href="#assertions" title="Direct link to heading">​</a></h4><p>The test case is not very useful unless it verifies its results. There are two ways to
assert that the test behaves as expected.</p><p>You can use a function <code>assert_equals(expected, got)</code> inside step functions to confirm
that data inside the step functions is valid. Secondly, you can define a method
<code>check_results(self, flow, checker)</code> in your test class, which verifies the stored
results after the flow has been executed successfully.</p><p>Use</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">checker.assert_artifact(step_name, artifact_name, expected_value)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>to assert that steps contain the expected data artifacts.</p><p>Take a look at existing test cases in the <code>tests</code> directory to get an idea how this
works in practice.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="graphs"><strong>Graphs</strong><a class="hash-link" href="#graphs" title="Direct link to heading">​</a></h3><p>Graphs are simple JSON representations of directed graphs. They list every step in a
graph and transitions between them. Every step can have an optional list of custom
qualifiers, as described above.</p><p>You can take a look at the existing graphs in the <code>graphs</code> directory to get an idea of
the syntax.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="checkers"><strong>Checkers</strong><a class="hash-link" href="#checkers" title="Direct link to heading">​</a></h3><p>Currently, the test harness exercises two types of user interfaces: The command-line
interface, defined in <code>cli_check.py</code>, and the Python API, defined in <code>mli_check.py</code>.</p><p>Currently, you can use these checkers to assert values of data artifacts or log output.
If you want to add tests for new types of functionality in the CLI and/or the Python
API, you should add a new method in the <code>MetaflowCheck</code> base class and corresponding
implementations in <code>mli_check.py</code> and <code>cli_check.py</code>. If certain functionality is only
available in one of the interfaces, you can provide a stub implementation returning
<code>True</code> in the other checker class.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="usage">Usage<a class="hash-link" href="#usage" title="Direct link to heading">​</a></h2><p>The test harness is executed by running <code>run_tests.py</code>. By default, it executes all
valid combinations of contexts, tests, graphs, and checkers. This mode is suitable for
automated tests run by a CI system.</p><p>When testing locally, it is recommended to run the test suite as follows:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd metaflow/test/core</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PYTHONPATH=`pwd`/../../ python run_tests.py --debug --contexts dev-local</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This uses only the <code>dev_local</code> context, which does not depend on any over-the-network
communication like <code>--metadata=service</code> or <code>--datastore=s3</code>. The <code>--debug</code> flag makes
the harness fail fast when the first test case fails. The default mode is to run all
test cases and summarize all failures in the end.</p><p>You can run a single test case as follows:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd metaflow/test/core</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PYTHONPATH=`pwd`/../../ python run_tests.py --debug --contexts dev-local --graphs single-linear-step --tests BasicArtifactTest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This chooses a single context, a single graph, and a single test. If you are developing
a new test, this is the fastest way to test the test.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="coverage-report">Coverage report<a class="hash-link" href="#coverage-report" title="Direct link to heading">​</a></h3><p>The test harness uses the <code>coverage</code> package in Python to produce a test coverage
report. By default, you can find a comprehensive test coverage report in the <code>coverage</code>
directory after the test harness has finished.</p><p>After you have developed a new feature in Metaflow, use the line-by-line coverage report
to confirm that all lines related the new feature are touched by the tests.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.dev/Netflix/metaflow-docs/blob/master/docs/internals/testing-philosophy.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/internals/technical-overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Technical Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/internals/contributing"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Contributing to Metaflow</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#metaflow-test-suite" class="table-of-contents__link toc-highlight">Metaflow Test Suite</a></li><li><a href="#specifications" class="table-of-contents__link toc-highlight">Specifications</a><ul><li><a href="#contexts" class="table-of-contents__link toc-highlight"><strong>Contexts</strong></a></li><li><a href="#tests" class="table-of-contents__link toc-highlight"><strong>Tests</strong></a></li><li><a href="#graphs" class="table-of-contents__link toc-highlight"><strong>Graphs</strong></a></li><li><a href="#checkers" class="table-of-contents__link toc-highlight"><strong>Checkers</strong></a></li></ul></li><li><a href="#usage" class="table-of-contents__link toc-highlight">Usage</a><ul><li><a href="#coverage-report" class="table-of-contents__link toc-highlight">Coverage report</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/assets/js/runtime~main.46b91267.js"></script>
<script src="/assets/js/main.f9ec58aa.js"></script>
</body>
</html>